<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–∫—Ç–æ—Ä Word –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</title>
    <script src="https://unpkg.com/mammoth@1.4.21/mammoth.browser.min.js"></script>
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .toolbar {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108,117,125,0.3);
        }

        .file-input {
            display: none;
        }

        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: 700px;
        }

        .editor-panel {
            padding: 30px;
            border-right: 1px solid #dee2e6;
            background: #fafafa;
            overflow-y: auto;
            max-height: 700px;
        }

        .preview-panel {
            padding: 30px;
            background: white;
            overflow-y: auto;
            max-height: 700px;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }

        .format-toolbar {
            background: #e9ecef;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .format-btn {
            padding: 10px 15px;
            border: 1px solid #ced4da;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .format-btn:hover {
            background: #f8f9fa;
            transform: translateY(-1px);
        }

        .format-btn.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }

        .document-content {
            line-height: 1.6;
            font-size: 14px;
            color: #333;
            text-align: left;
            max-width: none;
            margin: 0;
            padding: 0;
        }

        .editable-field {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 4px;
            cursor: text;
            transition: all 0.3s ease;
            min-width: 100px;
            display: inline-block;
        }

        .editable-field:hover {
            background: #ffeaa7;
            border-color: #fdcb6e;
            transform: scale(1.02);
        }

        .editable-field:focus {
            outline: none;
            background: white;
            border: 2px solid #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .field-item {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .field-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .field-editor {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            padding: 12px;
            border-radius: 6px;
            min-height: 50px;
            cursor: text;
            font-size: 14px;
            line-height: 1.4;
            width: 100%;
        }

        .field-editor:focus {
            outline: none;
            background: white;
            border: 2px solid #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .field-actions {
            margin-top: 10px;
            display: flex;
            gap: 8px;
        }

        .field-btn {
            padding: 6px 12px;
            font-size: 12px;
            border: 1px solid #ced4da;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .field-btn:hover {
            background: #f8f9fa;
        }

        .field-btn.danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .field-btn.danger:hover {
            background: #c82333;
        }

        .status {
            padding: 15px;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
            }
            
            .editor-panel {
                border-right: none;
                border-bottom: 1px solid #dee2e6;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù –†–µ–¥–∞–∫—Ç–æ—Ä –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç</h1>
            <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤–∞—à –¥–æ–∫—É–º–µ–Ω—Ç. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∂–µ–ª—Ç—ã–µ –ø–æ–ª—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>

        <div class="toolbar">
            <input type="file" id="fileInput" class="file-input" accept=".docx" />
            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å .docx —Ñ–∞–π–ª
            </button>
            <button class="btn btn-primary" onclick="loadDefaultDocument()">
                üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è
            </button>
            <button class="btn btn-primary" onclick="loadEmbeddedTemplate()">
                üìÑ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
            </button>
            <button class="btn btn-success" onclick="downloadDocument()" id="downloadBtn" disabled>
                üíæ –°–∫–∞—á–∞—Ç—å .docx (Word)
            </button>
            <button class="btn btn-secondary" onclick="loadTemplate()">
                üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω
            </button>
            <button class="btn btn-secondary" onclick="clearAll()">
                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å
            </button>
            <button class="btn btn-secondary" onclick="showManualFieldCreator()">
                ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—è –≤—Ä—É—á–Ω—É—é
            </button>
            <button class="btn btn-secondary" onclick="createSimpleDocx()">
                üìÑ –¢–µ—Å—Ç .docx
            </button>
            <button class="btn btn-secondary" onclick="createDocxFromHtml()">
                üìÑ HTML –¥–ª—è Word
            </button>
            <button class="btn btn-secondary" onclick="toggleAutoFormat()" id="autoFormatBtn">
                üîÑ –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç: –í–ö–õ
            </button>
            <button class="btn btn-secondary" onclick="toggleOriginalFormatting()" id="originalFormatBtn">
                üìÑ –û—Ä–∏–≥–∏–Ω–∞–ª: –í–ö–õ
            </button>
            <button class="btn btn-secondary" onclick="showDebugInfo()">
                üîç –û—Ç–ª–∞–¥–∫–∞
            </button>
            <button class="btn btn-secondary" onclick="loadHtmlFromFile()">
                üìã –ü–æ–∫–∞–∑–∞—Ç—å HTML –∫–æ–¥
            </button>
            <button class="btn btn-secondary" onclick="exportOriginalFormat()">
                üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            </button>
            <button class="btn btn-success" onclick="forceDocxExport()">
                üìÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π .docx —ç–∫—Å–ø–æ—Ä—Ç
            </button>
        </div>

        <div class="status" id="status"></div>
        <div class="loading" id="loading">
            <div class="spinner"></div>
            –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...
        </div>

        <div class="editor-container">
            <div class="editor-panel">
                <div class="panel-title">
                    ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ–ª–µ–π
                </div>
                <div class="format-toolbar">
                    <button class="format-btn" onclick="formatField('bold')" title="–ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç">
                        <strong>B</strong>
                    </button>
                    <button class="format-btn" onclick="formatField('italic')" title="–ö—É—Ä—Å–∏–≤">
                        <em>I</em>
                    </button>
                    <button class="format-btn" onclick="formatField('underline')" title="–ü–æ–¥—á–µ—Ä–∫–Ω—É—Ç—ã–π">
                        <u>U</u>
                    </button>
                    <button class="format-btn" onclick="changeFieldColor()" title="–ò–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç">
                        üé®
                    </button>
                    <button class="format-btn" onclick="clearFormatting()" title="–û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ">
                        üßπ
                    </button>
                </div>
                <div id="fieldsContainer">
                    <div class="empty-state">
                        <p>üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π</p>
                        <p style="margin-top: 10px; font-size: 12px;">–ñ–µ–ª—Ç—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏</p>
                    </div>
                </div>
            </div>

            <div class="preview-panel">
                <div class="panel-title">
                    üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
                </div>
                <div id="preview" class="document-content">
                    <div class="empty-state">
                        <p>üëÄ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p>
                        <p style="margin-top: 10px; font-size: 12px;">–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let documentData = null;
        let editableFields = [];
        let currentField = null;
        let autoFormatEnabled = true;
        let preserveOriginalFormat = true;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.name.endsWith('.docx')) {
                loadDocument(file);
            } else {
                showStatus('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª .docx', 'error');
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function loadDocument(file) {
            showLoading(true);
            showStatus('');

            try {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.convertToHtml({arrayBuffer: arrayBuffer});
                
                documentData = {
                    html: result.value,
                    originalHtml: result.value
                };

                processDocument();
                showStatus(`–î–æ–∫—É–º–µ–Ω—Ç "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!`, 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ HTML —Ñ–∞–π–ª–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        async function loadDefaultDocument() {
            showLoading(true);
            showStatus('–ó–∞–≥—Ä—É–∂–∞–µ–º –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è...');

            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª
                let htmlContent = '';
                try {
                    const response = await fetch('./–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç .htm');
                    if (response.ok) {
                        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π
                        const arrayBuffer = await response.arrayBuffer();
                        const decoder = new TextDecoder('windows-1251');
                        htmlContent = decoder.decode(arrayBuffer);
                    }
                } catch (fetchError) {
                    console.log('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ fetch, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω');
                    console.log('–û—à–∏–±–∫–∞:', fetchError);
                }
                
                // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
                if (!htmlContent) {
                    htmlContent = getEmbeddedArmeniaTemplate();
                }
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ body –∏–∑ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;
                
                // –ò—â–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ body
                const bodyContent = tempDiv.querySelector('body');
                let contentHtml = '';
                
                if (bodyContent) {
                    contentHtml = bodyContent.innerHTML;
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç body, –±–µ—Ä–µ–º –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                    contentHtml = tempDiv.innerHTML;
                }
                
                documentData = {
                    html: contentHtml,
                    originalHtml: contentHtml
                };

                processDocument();
                showStatus('–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ HTML —Ñ–∞–π–ª–∞:', error);
                showStatus('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –ù–∞–∂–º–∏—Ç–µ "üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è" –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é.', 'error');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                document.getElementById('fieldsContainer').innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin: 20px 0;">
                        <h4 style="color: #856404; margin-bottom: 15px;">üìÑ –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</h4>
                        <p style="margin-bottom: 15px; color: #856404;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:</p>
                        <ul style="margin-left: 20px; color: #856404; margin-bottom: 15px;">
                            <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìÑ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω" –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞</li>
                            <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å –®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞</li>
                            <li>–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ "üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å .docx —Ñ–∞–π–ª" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –≤—Ä—É—á–Ω—É—é</li>
                        </ul>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="loadEmbeddedTemplate()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                üìÑ –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
                            </button>
                            <button onclick="loadDefaultDocument()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                                üîÑ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
                            </button>
                        </div>
                    </div>
                `;
            } finally {
                showLoading(false);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞
        function loadEmbeddedTemplate() {
            showLoading(true);
            showStatus('–ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω...');
            
            try {
                const htmlContent = getEmbeddedArmeniaTemplate();
                
                documentData = {
                    html: htmlContent,
                    originalHtml: htmlContent
                };

                processDocument();
                showStatus('–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω –ê—Ä–º–µ–Ω–∏—è (fallback –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è)
        function getEmbeddedArmeniaTemplate() {
            return `
                <div style="font-family: 'Times New Roman', serif; font-size: 10pt; line-height: 1.15; max-width: 520pt; margin: 0 auto;">
                    <table border="1" cellspacing="0" cellpadding="0" width="694" style="margin-left: -21.15pt; border-collapse: collapse; border: none;">
                        <tr>
                            <td width="694" valign="top" style="width: 520.5pt; border: solid white 1.0pt; padding: 0cm 5.4pt;">
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: center; line-height: normal;">
                                    <b>AGREEMENT ‚Ññ <span style="background: yellow;">25.09.04</span></b>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-top: 0cm; margin-right: -37.2pt; margin-bottom: 0cm; margin-left: 7.05pt; text-align: justify; line-height: normal;">
                                    –î–∞—Ç–∞: <span style="background: yellow;">04 September 2025</span>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: 115%;">
                                    <b><span style="background: yellow;">Mindtrix LLC</span></b>, hereinafter referred to as the "Customer" on the one hand 
                                    and <b>Time Quest Lab LLC</b>, hereinafter referred to as the "Executor" on the other hand, 
                                    together referred to as the "Parties", have finalized the present Agreement, as follows:
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    <b>1. SUBJECT OF AGREEMENT</b>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    - <span style="background: yellow;">Prepare equipment for escape room;</span><br>
                                    - <span style="background: #FCE5CD;">Prepare decoration for escape room;</span><br>
                                    - <span style="background: #D9EAD3;">Prepare a separate modules according to the Specification to this agreement;</span>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    - To pass the result of works to the Customer,
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    and the Customer shall accept the result of work performed and pay for them in the order provided herein.
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    <b>2. TERMS</b>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    2.1. Executor undertakes to perform the work in accordance with p. 1.1. of this Agreement in the following terms:
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    2.1.1. The deadline for the work is <span style="background: yellow;">90 calendar days</span> 
                                    from the date the Executor receives the advance payment.
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    <b>3. PRICE OF WORK AND PAYMENT</b>
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    3.1. The total Agreement price is <span style="background: yellow;">10,000 (ten thousand) US dollars</span>.
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    3.2. Payment is made by the Customer <span style="background: yellow;">in the amount of 100% of the Contract value within</span> 
                                    3 working days from the date of notification.
                                </p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    <b>10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES</b>
                                </p>
                                
                                <div style="margin: 20px 0;">
                                    <p style="margin-bottom: 10px;"><b>Customer:</b></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">Mindtrix LLC</span></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">4155 Mapleton Drive</span></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">West Linn, OR 97068</span></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">+1 (229) 563-4204</span></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">mike@mindtrixescape.com</span></p>
                                    <p style="margin-bottom: 5px;"><span style="background: yellow;">Mike Walker</span></p>
                                </div>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">&nbsp;</p>
                                
                                <p style="margin-bottom: 0cm; text-align: justify; line-height: normal;">
                                    <b>Executor:</b><br>
                                    <span style="background: yellow;">Time Quest Lab LLC</span><br>
                                    <span style="background: yellow;">Armenia, Yerevan</span>
                                </p>
                            </td>
                        </tr>
                    </table>
                </div>
            `;
        }

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤ .docx —Ñ–æ—Ä–º–∞—Ç–µ
        async function forceDocxExport() {
            if (!documentData) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç', 'error');
                return;
            }

            showLoading(true);
            try {
                await createSimpleDocx();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ .docx —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ .docx —ç–∫—Å–ø–æ—Ä—Ç–∞: ' + error.message + '. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±—ã—á–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π
        function exportOriginalFormat() {
            if (!documentData) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç', 'error');
                return;
            }

            showLoading(true);
            try {
                // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = documentData.html;

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π, —Å–æ—Ö—Ä–∞–Ω—è—è –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
                editableFields.forEach(field => {
                    const element = tempDiv.querySelector(`#${field.id}`);
                    if (element) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —ç–ª–µ–º–µ–Ω—Ç–∞
                        const originalStyle = element.getAttribute('data-original-style') || element.getAttribute('style') || '';
                        
                        // –ó–∞–º–µ–Ω—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                        element.textContent = field.element.textContent;
                        
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å
                        if (originalStyle) {
                            element.setAttribute('style', originalStyle);
                        }
                        
                        // –£–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ ID –∏ –∫–ª–∞—Å—Å—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        element.removeAttribute('id');
                        element.removeAttribute('class');
                        element.removeAttribute('contenteditable');
                        element.removeAttribute('data-original');
                        element.removeAttribute('data-original-style');
                    }
                });

                // –°–æ–∑–¥–∞–µ–º HTML –¥–æ–∫—É–º–µ–Ω—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="Generator" content="Word Editor">
                        <title>–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</title>
                        <style>
                            /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ Word */
                            body {
                                font-family: 'Times New Roman', serif;
                                font-size: 10pt;
                                line-height: 1.15;
                                margin: 0;
                                padding: 20px;
                            }
                            
                            table {
                                border-collapse: collapse;
                                width: 100%;
                                max-width: 520pt;
                            }
                            
                            td {
                                border: solid white 1.0pt;
                                padding: 0cm 5.4pt;
                                vertical-align: top;
                            }
                            
                            p {
                                margin-bottom: 0cm;
                                text-align: justify;
                                line-height: normal;
                            }
                            
                            p.center {
                                text-align: center;
                            }
                            
                            b, strong {
                                font-weight: bold;
                            }
                            
                            /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∂–µ–ª—Ç—ã—Ö –ø–æ–ª–µ–π */
                            [style*="background: yellow"], 
                            [style*="background:yellow"],
                            [style*="background-color: yellow"],
                            [style*="background-color:yellow"] {
                                background-color: yellow !important;
                            }
                            
                            /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥—Ä—É–≥–∏–µ —Ü–≤–µ—Ç–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è */
                            [style*="background: #FCE5CD"] {
                                background-color: #FCE5CD !important;
                            }
                            
                            [style*="background: #D9EAD3"] {
                                background-color: #D9EAD3 !important;
                            }
                        </style>
                    </head>
                    <body>
                        ${tempDiv.innerHTML}
                    </body>
                    </html>
                `;

                // –°–æ–∑–¥–∞–µ–º Blob –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                const blob = new Blob([htmlContent], { type: 'text/html' });
                saveAs(blob, '–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç_original_format.html');
                
                showStatus('–î–æ–∫—É–º–µ–Ω—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å—Ç–∏–ª–µ–π!', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ HTML —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∏–∑ —Ñ–∞–π–ª–∞ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        async function loadHtmlFromFile() {
            try {
                const response = await fetch('./–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç .htm');
                const htmlContent = await response.text();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
                console.log('=== HTML –°–û–î–ï–†–ñ–ò–ú–û–ï –î–õ–Ø –í–°–¢–†–ê–ò–í–ê–ù–ò–Ø ===');
                console.log(htmlContent);
                
                // –¢–∞–∫–∂–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ –ø–µ—Ä–≤—ã–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤
                document.getElementById('preview').innerHTML = `
                    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                        <h3>üìÑ HTML —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</h3>
                        <p>–ü–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—ã–≤–µ–¥–µ–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)</p>
                        <pre style="background: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; font-size: 10px; max-height: 400px; overflow-y: auto; white-space: pre-wrap;">${htmlContent.substring(0, 2000)}...</pre>
                        <button onclick="updatePreview()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            üîÑ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
                        </button>
                    </div>
                `;
                
                showStatus('HTML —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∏ –≤—ã–≤–µ–¥–µ–Ω–æ –≤ –∫–æ–Ω—Å–æ–ª—å', 'success');
            } catch (error) {
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ HTML —Ñ–∞–π–ª–∞: ' + error.message, 'error');
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —à–∞–±–ª–æ–Ω–∞
        function loadTemplate() {
            const templateHtml = `
                <div style="font-family: 'Times New Roman', serif; font-size: 12pt; line-height: 1.5; max-width: 800px; margin: 0 auto;">
                    <h2 style="text-align: center; margin-bottom: 30px;">AGREEMENT ‚Ññ <span style="background: yellow; padding: 2px 6px;">25.09.04</span></h2>
                    <p style="text-align: right; margin-bottom: 30px;">–î–∞—Ç–∞: <span style="background: yellow; padding: 2px 6px;">04 September 2025</span></p>
                    
                    <p style="margin-bottom: 20px;"><strong><span style="background: yellow; padding: 2px 6px;">Mindtrix LLC</span></strong>, hereinafter referred to as the "Customer" on the one hand and <strong>Time Quest Lab LLC</strong>, hereinafter referred to as the "Executor" on the other hand, together referred to as the "Parties", have finalized the present Agreement, as follows:</p>
                    
                    <h3 style="margin: 30px 0 15px 0;">1. SUBJECT OF AGREEMENT</h3>
                    <p style="margin-bottom: 15px;">1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:</p>
                    <ul style="margin-left: 20px; margin-bottom: 20px;">
                        <li style="margin-bottom: 8px;"><span style="background: yellow; padding: 2px 6px;">Prepare equipment for escape room</span></li>
                        <li style="margin-bottom: 8px;"><span style="background: yellow; padding: 2px 6px;">Prepare decoration for escape room</span></li>
                        <li style="margin-bottom: 8px;"><span style="background: yellow; padding: 2px 6px;">Prepare separate modules according to the Specification</span></li>
                    </ul>
                    
                    <h3 style="margin: 30px 0 15px 0;">2. TERMS</h3>
                    <p style="margin-bottom: 15px;">2.1.1. The deadline for the work is <span style="background: yellow; padding: 2px 6px;">90 calendar days</span> from the date the Executor receives the advance payment.</p>
                    
                    <h3 style="margin: 30px 0 15px 0;">3. PRICE OF WORK AND PAYMENT</h3>
                    <p style="margin-bottom: 15px;">3.1. The total Agreement price is <span style="background: yellow; padding: 2px 6px;">10,000 (ten thousand) US dollars</span>.</p>
                    <p style="margin-bottom: 15px;">3.2. Payment is made by the Customer <span style="background: yellow; padding: 2px 6px;">in the amount of 100% of the Contract value within</span> 3 working days from the date of notification.</p>
                    
                    <h3 style="margin: 30px 0 15px 0;">10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES</h3>
                    <div style="margin: 20px 0;">
                        <p style="margin-bottom: 10px;"><strong>Customer:</strong></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">Mindtrix LLC</span></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">4155 Mapleton Drive</span></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">West Linn, OR 97068</span></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">+1 (229) 563-4204</span></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">mike@mindtrixescape.com</span></p>
                        <p style="margin-bottom: 5px;"><span style="background: yellow; padding: 2px 6px;">Mike Walker</span></p>
                    </div>
                </div>
            `;

            documentData = {
                html: templateHtml,
                originalHtml: templateHtml
            };

            processDocument();
            showStatus('–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω!', 'success');
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        function processDocument() {
            if (!documentData) return;

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = documentData.html;

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            saveOriginalStyles(tempDiv);

            // –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∂–µ–ª—Ç–æ–≥–æ —Ñ–æ–Ω–∞
            const yellowSelectors = [
                '[style*="background:yellow"]',
                '[style*="background: yellow"]', 
                '[style*="background-color:yellow"]',
                '[style*="background-color: yellow"]',
                '[style*="background: #ffff00"]',
                '[style*="background:#ffff00"]',
                '[style*="background-color: #ffff00"]',
                '[style*="background-color:#ffff00"]',
                '[style*="background: #ffc107"]',
                '[style*="background:#ffc107"]',
                '[style*="background-color: #ffc107"]',
                '[style*="background-color:#ffc107"]',
                '[style*="highlight"]',
                '[class*="highlight"]',
                '[class*="yellow"]',
                '.highlight',
                '.yellow'
            ];

            let yellowElements = [];
            yellowSelectors.forEach(selector => {
                try {
                    const elements = tempDiv.querySelectorAll(selector);
                    yellowElements = yellowElements.concat(Array.from(elements));
                } catch (e) {
                    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
                }
            });

            // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
            yellowElements = [...new Set(yellowElements)];

            // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∂–µ–ª—Ç—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –ø–æ–ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É
            if (yellowElements.length === 0) {
                yellowElements = findHighlightedText(tempDiv);
            }

            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
            if (yellowElements.length === 0) {
                showHighlightInstructions(tempDiv);
                return;
            }
            
            editableFields = [];
            yellowElements.forEach((element, index) => {
                const fieldId = `field_${index}`;
                const originalText = element.textContent.trim();
                
                if (originalText.length === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —ç–ª–µ–º–µ–Ω—Ç–∞
                const originalStyle = element.getAttribute('style') || '';
                
                // –°–æ–∑–¥–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ
                const editableSpan = document.createElement('span');
                editableSpan.id = fieldId;
                editableSpan.className = 'editable-field';
                editableSpan.contentEditable = true;
                editableSpan.textContent = originalText;
                editableSpan.setAttribute('data-original', originalText);
                editableSpan.setAttribute('data-original-style', originalStyle);
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å —Å –∂–µ–ª—Ç—ã–º —Ñ–æ–Ω–æ–º
                editableSpan.style.cssText = originalStyle;
                editableSpan.style.backgroundColor = 'yellow';
                editableSpan.style.padding = '2px 6px';
                editableSpan.style.borderRadius = '3px';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                editableSpan.addEventListener('input', () => {
                    autoFormatField(editableSpan);
                    updatePreview();
                });
                editableSpan.addEventListener('focus', () => setCurrentField(fieldId));
                editableSpan.addEventListener('blur', () => {
                    autoFormatField(editableSpan);
                    clearCurrentField();
                });
                
                // –ó–∞–º–µ–Ω—è–µ–º —ç–ª–µ–º–µ–Ω—Ç
                element.parentNode.replaceChild(editableSpan, element);
                
                editableFields.push({
                    id: fieldId,
                    element: editableSpan,
                    originalText: originalText
                });
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º HTML, —Å–æ—Ö—Ä–∞–Ω—è—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
            documentData.html = preserveOriginalFormatting(tempDiv.innerHTML);
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–ª—è –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
            displayFields();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            updatePreview();
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
            document.getElementById('downloadBtn').disabled = false;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã—Ö —Å—Ç–∏–ª–µ–π –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function saveOriginalStyles(container) {
            const allElements = container.querySelectorAll('*');
            allElements.forEach(element => {
                const style = element.getAttribute('style');
                if (style) {
                    element.setAttribute('data-original-style', style);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–∏
                const computedStyle = window.getComputedStyle(element);
                if (computedStyle.textAlign === 'center') {
                    element.setAttribute('data-original-align', 'center');
                }
                if (computedStyle.margin.includes('auto')) {
                    element.setAttribute('data-original-margin', computedStyle.margin);
                }
                if (computedStyle.maxWidth !== 'none') {
                    element.setAttribute('data-original-maxwidth', computedStyle.maxWidth);
                }
                if (computedStyle.width !== 'auto') {
                    element.setAttribute('data-original-width', computedStyle.width);
                }
            });
        }

        // –ü–æ–∏—Å–∫ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É (–µ—Å–ª–∏ —Å—Ç–∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)
        function findHighlightedText(container) {
            const elements = container.querySelectorAll('*');
            const highlightedElements = [];
            
            elements.forEach(element => {
                const text = element.textContent.trim();
                
                // –ò—â–µ–º —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –∑–∞–ø–æ–ª–Ω—è–µ–º—ã–µ –ø–æ–ª—è
                if (text && (
                    text.match(/^\d{2}\.\d{2}\.\d{2}$/) || // –¥–∞—Ç—ã —Ç–∏–ø–∞ 25.09.04
                    text.match(/^\d+ calendar days$/) || // —Å—Ä–æ–∫–∏
                    text.match(/^\d+,?\d*\s*\([^)]+\)\s*US dollars?$/) || // —Å—É–º–º—ã
                    text.match(/^[A-Z][a-z]+\s+[A-Z][a-z]+$/) || // –∏–º–µ–Ω–∞
                    text.match(/^\+?\d+[\s\-\(\)\d]+$/) || // —Ç–µ–ª–µ—Ñ–æ–Ω—ã
                    text.match(/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/) || // email
                    text.match(/^\d+\s+[A-Za-z]+\s+[A-Za-z]+/) || // –∞–¥—Ä–µ—Å–∞
                    text.length > 3 && text.length < 50 && 
                    (text.includes('LLC') || text.includes('Company') || text.includes('Ltd'))
                )) {
                    highlightedElements.push(element);
                }
            });
            
            return highlightedElements;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –≤—ã–¥–µ–ª–µ–Ω–∏—é
        function showHighlightInstructions(container) {
            const containerDiv = document.getElementById('fieldsContainer');
            containerDiv.innerHTML = `
                <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #856404; margin-bottom: 15px;">‚ö†Ô∏è –ñ–µ–ª—Ç—ã–µ –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h4>
                    <p style="margin-bottom: 10px; color: #856404;">–í –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Ç–µ–∫—Å—Ç–∞ —Å –∂–µ–ª—Ç—ã–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º.</p>
                    <p style="margin-bottom: 15px; color: #856404;">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</p>
                    <ul style="margin-left: 20px; color: #856404; margin-bottom: 15px;">
                        <li>–í—ã–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ</li>
                        <li>–§–æ—Ä–º–∞—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π</li>
                        <li>–î–æ–∫—É–º–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                    </ul>
                    <p style="margin-bottom: 15px; color: #856404;"><strong>–†–µ—à–µ–Ω–∏—è:</strong></p>
                    <ul style="margin-left: 20px; color: #856404; margin-bottom: 15px;">
                        <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ —Ç–µ–∫—Å—Ç –≤—ã–¥–µ–ª–µ–Ω –∂–µ–ª—Ç—ã–º —Ü–≤–µ—Ç–æ–º</li>
                        <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω" –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                        <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –≤ Word —Å —è–≤–Ω—ã–º –∂–µ–ª—Ç—ã–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º</li>
                    </ul>
                    <button onclick="loadTemplate()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                    </button>
                </div>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π HTML –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            document.getElementById('preview').innerHTML = `
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h4 style="color: #495057; margin-bottom: 15px;">üìÑ –ò—Å—Ö–æ–¥–Ω—ã–π HTML –¥–æ–∫—É–º–µ–Ω—Ç–∞:</h4>
                    <pre style="background: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; overflow-x: auto; font-size: 12px; color: #333;">${container.innerHTML}</pre>
                </div>
            `;
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ
        function displayFields() {
            const container = document.getElementById('fieldsContainer');
            container.innerHTML = '';

            if (editableFields.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>–í –¥–æ–∫—É–º–µ–Ω—Ç–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∂–µ–ª—Ç—ã—Ö –≤—ã–¥–µ–ª–µ–Ω–∏–π –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p></div>';
                return;
            }

            editableFields.forEach((field, index) => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-item';
                
                fieldDiv.innerHTML = `
                    <div class="field-label">–ü–æ–ª–µ ${index + 1}</div>
                    <div id="${field.id}_display" class="field-editor" contenteditable="true">
                        ${field.originalText}
                    </div>
                    <div class="field-actions">
                        <button class="field-btn" onclick="resetField('${field.id}')">–°–±—Ä–æ—Å–∏—Ç—å</button>
                        <button class="field-btn danger" onclick="deleteField('${field.id}')">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;

                const displayElement = fieldDiv.querySelector(`#${field.id}_display`);
                displayElement.addEventListener('input', () => {
                    autoFormatField(displayElement);
                    field.element.textContent = displayElement.textContent;
                    updatePreview();
                });
                displayElement.addEventListener('focus', () => setCurrentField(field.id));
                displayElement.addEventListener('blur', () => {
                    autoFormatField(displayElement);
                    field.element.textContent = displayElement.textContent;
                    updatePreview();
                });

                container.appendChild(fieldDiv);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        function updatePreview() {
            if (!documentData) return;

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = documentData.html;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ–ª–µ–π
            editableFields.forEach(field => {
                const element = tempDiv.querySelector(`#${field.id}`);
                if (element) {
                    element.textContent = field.element.textContent;
                }
            });

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏—à–Ω–∏—Ö
            const processedHtml = preserveOriginalFormatting(tempDiv.innerHTML);

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π HTML
            document.getElementById('preview').innerHTML = processedHtml;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function preserveOriginalFormatting(htmlContent) {
            if (!preserveOriginalFormat) {
                return htmlContent;
            }
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;

            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const allElements = tempDiv.querySelectorAll('*');
            allElements.forEach(element => {
                const style = element.style;
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                if (element.hasAttribute('data-original-style')) {
                    const originalStyle = element.getAttribute('data-original-style');
                    element.setAttribute('style', originalStyle);
                    return;
                }
                
                // –î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∂–µ–ª—Ç–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                if (element.classList.contains('editable-field') || 
                    element.style.backgroundColor === '#ffc107' ||
                    element.style.backgroundColor === 'yellow') {
                    element.style.backgroundColor = 'yellow';
                    element.style.padding = '2px 6px';
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–æ
                if (style.textAlign === 'center' && !element.hasAttribute('data-original-align')) {
                    style.textAlign = '';
                }
                
                // –£–±–∏—Ä–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º
                if (style.margin === '0px auto' || style.margin === '0 auto') {
                    if (!element.hasAttribute('data-original-margin')) {
                        style.margin = '';
                    }
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —à–∏—Ä–∏–Ω—É
                if (style.maxWidth && !element.hasAttribute('data-original-maxwidth')) {
                    style.maxWidth = '';
                }
                
                if (style.width === '100%' && !element.hasAttribute('data-original-width')) {
                    style.width = '';
                }
            });

            return tempDiv.innerHTML;
        }

        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—è
        function setCurrentField(fieldId) {
            currentField = fieldId;
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª–µ
            editableFields.forEach(field => {
                field.element.style.boxShadow = field.id === fieldId ? '0 0 0 3px rgba(0,123,255,0.3)' : '';
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—è
        function clearCurrentField() {
            currentField = null;
            editableFields.forEach(field => {
                field.element.style.boxShadow = '';
            });
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è
        function formatField(format) {
            if (!currentField) return;

            const field = editableFields.find(f => f.id === currentField);
            if (!field) return;

            document.execCommand(format);
            updatePreview();
        }

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ–ª—è
        function changeFieldColor() {
            if (!currentField) return;

            const colors = ['#ffc107', '#28a745', '#dc3545', '#17a2b8', '#6f42c1'];
            const currentColor = editableFields.find(f => f.id === currentField)?.element.style.backgroundColor || '#ffc107';
            const currentIndex = colors.indexOf(currentColor);
            const nextColor = colors[(currentIndex + 1) % colors.length];

            const field = editableFields.find(f => f.id === currentField);
            if (field) {
                field.element.style.backgroundColor = nextColor;
                updatePreview();
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function clearFormatting() {
            if (!currentField) return;

            document.execCommand('removeFormat');
            updatePreview();
        }

        // –°–±—Ä–æ—Å –ø–æ–ª—è
        function resetField(fieldId) {
            const field = editableFields.find(f => f.id === fieldId);
            if (field) {
                field.element.textContent = field.originalText;
                updatePreview();
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—è
        function deleteField(fieldId) {
            const fieldIndex = editableFields.findIndex(f => f.id === fieldId);
            if (fieldIndex !== -1) {
                editableFields.splice(fieldIndex, 1);
                displayFields();
                updatePreview();
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ
        function clearAll() {
            documentData = null;
            editableFields = [];
            currentField = null;
            document.getElementById('fieldsContainer').innerHTML = '<div class="empty-state"><p>üìÑ –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–µ–π</p></div>';
            document.getElementById('preview').innerHTML = '<div class="empty-state"><p>üëÄ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</p></div>';
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('fileInput').value = '';
            showStatus('');
        }

        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        async function downloadDocument() {
            if (!documentData) return;

            showLoading(true);
            try {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = documentData.html; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
                editableFields.forEach(field => {
                    const element = tempDiv.querySelector(`#${field.id}`);
                    if (element) {
                        element.textContent = field.element.textContent;
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
                        if (field.element.getAttribute('data-original-style')) {
                            element.setAttribute('style', field.element.getAttribute('data-original-style'));
                        } else {
                            // –ï—Å–ª–∏ –Ω–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è, –ø—Ä–∏–º–µ–Ω—è–µ–º –∂–µ–ª—Ç—ã–π —Ñ–æ–Ω
                            element.style.backgroundColor = 'yellow';
                            element.style.padding = '2px 6px';
                        }
                    }
                });

                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ ID
                const editableElements = tempDiv.querySelectorAll('[id^="field_"]');
                editableElements.forEach(element => {
                    element.removeAttribute('id');
                    element.removeAttribute('class');
                    element.contentEditable = false;
                });

                const finalHtml = tempDiv.innerHTML;

                // –ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å .docx —Ñ–∞–π–ª (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç .docx –Ω–∞–¥ HTML)
                try {
                    console.log('–ü—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å .docx —Ñ–∞–π–ª...');
                    await createSimpleDocx();
                } catch (error) {
                    console.log('–ü—Ä–æ—Å—Ç–æ–π .docx –Ω–µ —É–¥–∞–ª—Å—è, –ø—Ä–æ–±—É–µ–º —Å–ª–æ–∂–Ω—ã–π —Å–ø–æ—Å–æ–±...');
                    try {
                        await createDocxFile(finalHtml);
                    } catch (error2) {
                        console.log('–°–ª–æ–∂–Ω—ã–π .docx –Ω–µ —É–¥–∞–ª—Å—è, —Å–æ–∑–¥–∞–µ–º HTML —Ñ–∞–π–ª –¥–ª—è Word...');
                        await createDocxFromHtml();
                    }
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', error);
                showStatus('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞', 'error');
            } finally {
                showLoading(false);
            }
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è .docx —Ñ–∞–π–ª–∞
        async function createSimpleDocx() {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ docx
                if (typeof docx === 'undefined' || !docx.Document) {
                    throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ docx –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }

                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = documentData.html; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
                editableFields.forEach(field => {
                    const element = tempDiv.querySelector(`#${field.id}`);
                    if (element) {
                        element.textContent = field.element.textContent;
                        // –£–±–∏—Ä–∞–µ–º ID –∏ –∫–ª–∞—Å—Å—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                        element.removeAttribute('id');
                        element.removeAttribute('class');
                        element.contentEditable = false;
                    }
                });

                // –ü–∞—Ä—Å–∏–º HTML –≤ —ç–ª–µ–º–µ–Ω—Ç—ã docx
                const documentElements = [];
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –∞–±–∑–∞—Ü—ã
                const paragraphs = tempDiv.querySelectorAll('p');
                paragraphs.forEach(p => {
                    if (p.textContent.trim()) {
                        const textRuns = [];
                        
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞–±–∑–∞—Ü–∞
                        Array.from(p.childNodes).forEach(node => {
                            if (node.nodeType === Node.TEXT_NODE) {
                                if (node.textContent.trim()) {
                                    textRuns.push(new docx.TextRun({
                                        text: node.textContent,
                                        size: 20, // 10pt
                                        font: "Times New Roman"
                                    }));
                                }
                            } else if (node.nodeType === Node.ELEMENT_NODE) {
                                const text = node.textContent;
                                if (text.trim()) {
                                    let textRun = new docx.TextRun({
                                        text: text,
                                        size: 20,
                                        font: "Times New Roman"
                                    });
                                    
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                                    if (node.tagName.toLowerCase() === 'b' || node.tagName.toLowerCase() === 'strong') {
                                        textRun.bold = true;
                                    }
                                    
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∏–ª–∏
                                    const style = node.style;
                                    if (style) {
                                        if (style.backgroundColor === 'yellow' || style.backgroundColor === '#ffc107') {
                                            textRun.highlight = 'yellow';
                                        }
                                        if (style.fontWeight === 'bold') {
                                            textRun.bold = true;
                                        }
                                    }
                                    
                                    textRuns.push(textRun);
                                }
                            }
                        });
                        
                        if (textRuns.length > 0) {
                            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ
                            let alignment = 'left';
                            const pStyle = p.style;
                            if (pStyle.textAlign === 'center') {
                                alignment = 'center';
                            } else if (pStyle.textAlign === 'right') {
                                alignment = 'right';
                            }
                            
                            documentElements.push(new docx.Paragraph({
                                children: textRuns,
                                alignment: alignment,
                                spacing: {
                                    after: 200, // 10pt –ø–æ—Å–ª–µ –∞–±–∑–∞—Ü–∞
                                }
                            }));
                        }
                    }
                });
                
                // –ï—Å–ª–∏ –Ω–µ—Ç –∞–±–∑–∞—Ü–µ–≤, —Å–æ–∑–¥–∞–µ–º –∏–∑ –≤—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–∞
                if (documentElements.length === 0) {
                    const allText = tempDiv.textContent;
                    if (allText.trim()) {
                        documentElements.push(new docx.Paragraph({
                            children: [new docx.TextRun({
                                text: allText,
                                size: 20,
                                font: "Times New Roman"
                            })]
                        }));
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã
                if (documentElements.length === 0) {
                    throw new Error('–ù–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞');
                }
                
                // –°–æ–∑–¥–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
                const doc = new docx.Document({
                    sections: [{
                        properties: {
                            page: {
                                size: {
                                    width: 595.3, // A4 width in points
                                    height: 841.9, // A4 height in points
                                },
                                margin: {
                                    top: 850, // 1 inch
                                    right: 850,
                                    bottom: 850,
                                    left: 850,
                                },
                            },
                        },
                        children: documentElements,
                    }],
                });

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
                const blob = await docx.Packer.toBlob(doc);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                if (blob.size === 0) {
                    throw new Error('–°–æ–∑–¥–∞–Ω –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª');
                }
                
                saveAs(blob, '–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç.docx');
                showStatus('‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ .docx (Word)!', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ .docx:', error);
                throw error; // –ü–µ—Ä–µ–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ downloadDocument
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ .docx —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ HTML to Word –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
        async function createDocxFromHtml() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π HTML —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = documentData.html; // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π HTML

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
                editableFields.forEach(field => {
                    const element = tempDiv.querySelector(`#${field.id}`);
                    if (element) {
                        element.textContent = field.element.textContent;
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
                        if (field.element.getAttribute('data-original-style')) {
                            element.setAttribute('style', field.element.getAttribute('data-original-style'));
                        } else {
                            element.style.backgroundColor = 'yellow';
                            element.style.padding = '2px 6px';
                        }
                        // –£–±–∏—Ä–∞–µ–º ID
                        element.removeAttribute('id');
                        element.removeAttribute('class');
                        element.contentEditable = false;
                    }
                });

                const processedContent = tempDiv.innerHTML;
                
                // –°–æ–∑–¥–∞–µ–º HTML –¥–æ–∫—É–º–µ–Ω—Ç —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏
                const htmlContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç</title>
                        <style>
                            body { 
                                font-family: 'Times New Roman', serif; 
                                margin: 40px; 
                                line-height: 1.15;
                                font-size: 10pt;
                            }
                            table {
                                border-collapse: collapse;
                                width: 100%;
                                max-width: 520pt;
                            }
                            td {
                                border: solid white 1.0pt;
                                padding: 0cm 5.4pt;
                                vertical-align: top;
                            }
                            p {
                                margin-bottom: 0cm;
                                text-align: justify;
                                line-height: normal;
                            }
                            .center {
                                text-align: center;
                            }
                            b {
                                font-weight: bold;
                            }
                            /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∂–µ–ª—Ç—ã—Ö –ø–æ–ª–µ–π */
                            [style*="background: yellow"], [style*="background:yellow"] {
                                background-color: yellow !important;
                                padding: 2px 6px;
                            }
                        </style>
                    </head>
                    <body>
                        ${processedContent}
                    </body>
                    </html>
                `;

                // –°–æ–∑–¥–∞–µ–º Blob —Å HTML —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
                const blob = new Blob([htmlContent], { type: 'text/html' });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ HTML —Ñ–∞–π–ª (–∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –≤ Word)
                saveAs(blob, '–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç_edited.html');
                showStatus('‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ HTML (–æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Word –¥–ª—è .docx —Ñ–æ—Ä–º–∞—Ç–∞)', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è HTML:', error);
                showStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message, 'error');
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ .docx —Ñ–∞–π–ª–∞
        async function createDocxFile(htmlContent) {
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ docx
                if (typeof docx === 'undefined' || !docx.Document) {
                    throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ docx –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }

                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = htmlContent;

                // –ü–∞—Ä—Å–∏–º HTML –∏ —Å–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞
                const documentElements = parseHtmlToDocxElements(tempDiv);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –µ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞
                if (documentElements.length === 0) {
                    throw new Error('–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞');
                }

                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
                const doc = new docx.Document({
                    sections: [{
                        properties: {},
                        children: documentElements
                    }]
                });

                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏ —Å–∫–∞—á–∏–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
                const blob = await docx.Packer.toBlob(doc);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
                if (blob.size === 0) {
                    throw new Error('–°–æ–∑–¥–∞–Ω –ø—É—Å—Ç–æ–π —Ñ–∞–π–ª');
                }
                
                saveAs(blob, 'edited_document.docx');
                showStatus('–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω –∫–∞–∫ .docx!', 'success');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è .docx:', error);
                showStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è .docx: ' + error.message, 'error');
                // Fallback –∫ HTML –µ—Å–ª–∏ .docx –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
                createHtmlFallback(htmlContent);
            }
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ HTML –≤ —ç–ª–µ–º–µ–Ω—Ç—ã docx
        function parseHtmlToDocxElements(container) {
            const elements = [];
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            Array.from(container.children).forEach(element => {
                const tagName = element.tagName.toLowerCase();
                
                switch (tagName) {
                    case 'h1':
                    case 'h2':
                    case 'h3':
                    case 'h4':
                    case 'h5':
                    case 'h6':
                        elements.push(new docx.Heading(
                            parseInt(tagName.charAt(1)),
                            element.textContent
                        ));
                        break;
                        
                    case 'p':
                        const paragraphText = parseInlineFormatting(element);
                        elements.push(new docx.Paragraph({
                            children: paragraphText
                        }));
                        break;
                        
                    case 'ul':
                    case 'ol':
                        const listItems = Array.from(element.querySelectorAll('li')).map(li => 
                            new docx.ListItem({
                                children: [new docx.Paragraph({
                                    children: parseInlineFormatting(li)
                                })]
                            })
                        );
                        elements.push(new docx.UnorderedList(listItems));
                        break;
                        
                    case 'table':
                        elements.push(parseTable(element));
                        break;
                        
                    default:
                        if (element.textContent.trim()) {
                            elements.push(new docx.Paragraph({
                                children: [new docx.TextRun({
                                    text: element.textContent
                                })]
                            }));
                        }
                }
            });
            
            return elements;
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ inline —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function parseInlineFormatting(element) {
            const children = [];
            
            function processNode(node) {
                if (node.nodeType === Node.TEXT_NODE) {
                    if (node.textContent.trim()) {
                        children.push(new docx.TextRun({
                            text: node.textContent
                        }));
                    }
                } else if (node.nodeType === Node.ELEMENT_NODE) {
                    const tagName = node.tagName.toLowerCase();
                    const text = node.textContent;
                    
                    if (!text.trim()) return;
                    
                    let textRun = new docx.TextRun({ text });
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
                    if (tagName === 'strong' || tagName === 'b') {
                        textRun.bold = true;
                    }
                    if (tagName === 'em' || tagName === 'i') {
                        textRun.italics = true;
                    }
                    if (tagName === 'u') {
                        textRun.underline = {};
                    }
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∏–ª–∏
                    const style = node.style;
                    if (style) {
                        if (style.fontWeight === 'bold' || style.fontWeight === '700') {
                            textRun.bold = true;
                        }
                        if (style.fontStyle === 'italic') {
                            textRun.italics = true;
                        }
                        if (style.textDecoration === 'underline') {
                            textRun.underline = {};
                        }
                        if (style.backgroundColor === 'yellow' || style.backgroundColor === '#ffc107') {
                            textRun.highlight = 'yellow';
                        }
                    }
                    
                    children.push(textRun);
                }
            }
            
            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã
            Array.from(element.childNodes).forEach(processNode);
            
            return children.length > 0 ? children : [new docx.TextRun({ text: element.textContent })];
        }

        // –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü
        function parseTable(tableElement) {
            const rows = Array.from(tableElement.querySelectorAll('tr')).map(row => {
                const cells = Array.from(row.querySelectorAll('td, th')).map(cell => {
                    return new docx.TableCell({
                        children: [new docx.Paragraph({
                            children: parseInlineFormatting(cell)
                        })]
                    });
                });
                
                return new docx.TableRow({ children: cells });
            });
            
            return new docx.Table({ rows });
        }

        // Fallback –∫ HTML –µ—Å–ª–∏ .docx –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
        function createHtmlFallback(htmlContent) {
            const blob = new Blob([`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç</title>
                    <style>
                        body { 
                            font-family: 'Times New Roman', serif; 
                            margin: 40px; 
                            line-height: 1.15;
                            font-size: 10pt;
                        }
                        table {
                            border-collapse: collapse;
                            width: 100%;
                            max-width: 520pt;
                        }
                        td {
                            border: solid white 1.0pt;
                            padding: 0cm 5.4pt;
                            vertical-align: top;
                        }
                        p {
                            margin-bottom: 0cm;
                            text-align: justify;
                            line-height: normal;
                        }
                        .center {
                            text-align: center;
                        }
                        b {
                            font-weight: bold;
                        }
                        /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –∂–µ–ª—Ç—ã—Ö –ø–æ–ª–µ–π */
                        [style*="background: yellow"], [style*="background:yellow"] {
                            background-color: yellow !important;
                            padding: 2px 6px;
                        }
                        .highlighted { 
                            background-color: yellow; 
                            padding: 2px 6px;
                        }
                    </style>
                </head>
                <body>
                    ${htmlContent}
                </body>
                </html>
            `], { type: 'text/html' });

            saveAs(blob, '–®–ê–ë–õ–û–ù –ê—Ä–º–µ–Ω–∏—è_–ö–ª–∏–µ–Ω—Ç_fallback.html');
            showStatus('‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç —Å–∫–∞—á–∞–Ω –∫–∞–∫ HTML (fallback) - –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ Word –¥–ª—è .docx —Ñ–æ—Ä–º–∞—Ç–∞', 'success');
        }

        // –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã—Ö –ø–æ–ª–µ–π
        function showManualFieldCreator() {
            const container = document.getElementById('fieldsContainer');
            container.innerHTML = `
                <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <h4 style="color: #1976d2; margin-bottom: 15px;">‚úèÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–π –≤—Ä—É—á–Ω—É—é</h4>
                    <p style="margin-bottom: 15px; color: #1976d2;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º –ø–æ–ª–µ–º:</p>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #1976d2; font-weight: 500;">–¢–µ–∫—Å—Ç –ø–æ–ª—è:</label>
                        <input type="text" id="fieldText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—è" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; color: #1976d2; font-weight: 500;">–ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ:</label>
                        <input type="text" id="searchText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button onclick="createManualField()" style="background: #4caf50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–µ
                        </button>
                        <button onclick="searchInDocument()" style="background: #ff9800; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            üîç –ù–∞–π—Ç–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
                        </button>
                        <button onclick="displayFields()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                            ‚ùå –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                    
                    <div id="searchResults" style="margin-top: 15px;"></div>
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—è –≤—Ä—É—á–Ω—É—é
        function createManualField() {
            const fieldText = document.getElementById('fieldText').value.trim();
            if (!fieldText) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–ª—è', 'error');
                return;
            }

            const fieldId = `manual_field_${Date.now()}`;
            const editableSpan = document.createElement('span');
            editableSpan.id = fieldId;
            editableSpan.className = 'editable-field';
            editableSpan.contentEditable = true;
            editableSpan.textContent = fieldText;
            editableSpan.setAttribute('data-original', fieldText);
            editableSpan.style.backgroundColor = '#ffc107';
            editableSpan.style.padding = '2px 6px';
            editableSpan.style.borderRadius = '3px';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            editableSpan.addEventListener('input', () => updatePreview());
            editableSpan.addEventListener('focus', () => setCurrentField(fieldId));
            editableSpan.addEventListener('blur', () => clearCurrentField());
            
            editableFields.push({
                id: fieldId,
                element: editableSpan,
                originalText: fieldText
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            updatePreview();
            displayFields();
            showStatus(`–ü–æ–ª–µ "${fieldText}" —Å–æ–∑–¥–∞–Ω–æ!`, 'success');
        }

        // –ü–æ–∏—Å–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
        function searchInDocument() {
            const searchText = document.getElementById('searchText').value.trim();
            if (!searchText) {
                showStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞', 'error');
                return;
            }

            const previewDiv = document.getElementById('preview');
            const html = previewDiv.innerHTML;
            
            if (html.includes(searchText)) {
                const highlightedHtml = html.replace(
                    new RegExp(searchText.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g'),
                    `<span style="background: #ffeb3b; padding: 2px 4px; border-radius: 3px;">${searchText}</span>`
                );
                previewDiv.innerHTML = highlightedHtml;
                
                document.getElementById('searchResults').innerHTML = `
                    <div style="background: #d4edda; border: 1px solid #c3e6cb; border-radius: 4px; padding: 10px; color: #155724;">
                        ‚úÖ –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ! –¢–µ–∫—Å—Ç –≤—ã–¥–µ–ª–µ–Ω –∂–µ–ª—Ç—ã–º –≤ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–µ.
                    </div>
                `;
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Ç–µ–∫—Å—Ç–∞
                document.getElementById('fieldText').value = searchText;
            } else {
                document.getElementById('searchResults').innerHTML = `
                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; padding: 10px; color: #721c24;">
                        ‚ùå –¢–µ–∫—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ.
                    </div>
                `;
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function toggleAutoFormat() {
            autoFormatEnabled = !autoFormatEnabled;
            const btn = document.getElementById('autoFormatBtn');
            btn.textContent = `üîÑ –ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç: ${autoFormatEnabled ? '–í–ö–õ' : '–í–´–ö–õ'}`;
            btn.style.background = autoFormatEnabled ? '#28a745' : '#dc3545';
            showStatus(`–ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${autoFormatEnabled ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ'}`, 'success');
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function toggleOriginalFormatting() {
            preserveOriginalFormat = !preserveOriginalFormat;
            const btn = document.getElementById('originalFormatBtn');
            btn.textContent = `üìÑ –û—Ä–∏–≥–∏–Ω–∞–ª: ${preserveOriginalFormat ? '–í–ö–õ' : '–í–´–ö–õ'}`;
            btn.style.background = preserveOriginalFormat ? '#28a745' : '#dc3545';
            showStatus(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ${preserveOriginalFormat ? '–≤–∫–ª—é—á–µ–Ω–æ' : '–æ—Ç–∫–ª—é—á–µ–Ω–æ'}`, 'success');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            if (documentData) {
                updatePreview();
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
        function autoFormatField(element) {
            if (!autoFormatEnabled) return;
            
            const text = element.textContent.trim();
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
            if (text.match(/^\d{1,2}[.\-\/]\d{1,2}[.\-\/]\d{2,4}$/)) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–∏–¥
                const formattedDate = formatDate(text);
                if (formattedDate !== text) {
                    element.textContent = formattedDate;
                }
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º
            if (text.match(/^\d+[.,]?\d*\s*(–¥–æ–ª–ª–∞—Ä|dollar|usd|\$)/i)) {
                const formattedAmount = formatAmount(text);
                if (formattedAmount !== text) {
                    element.textContent = formattedAmount;
                }
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
            if (text.match(/^\d+[\s\-\(\)]*\d+[\s\-\(\)]*\d+/)) {
                const formattedPhone = formatPhone(text);
                if (formattedPhone !== text) {
                    element.textContent = formattedPhone;
                }
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ email
            if (text.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
                element.textContent = text.toLowerCase();
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            try {
                // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ –∫—Ä–æ–º–µ —Ç–æ—á–µ–∫
                const cleanDate = dateString.replace(/[\/\-]/g, '.');
                
                // –†–∞–∑–±–∏—Ä–∞–µ–º –¥–∞—Ç—É
                const parts = cleanDate.split('.');
                if (parts.length !== 3) return dateString;
                
                let day, month, year;
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã
                if (parts[2].length === 4) {
                    // –î–î.–ú–ú.–ì–ì–ì–ì –∏–ª–∏ –ú–ú.–î–î.–ì–ì–ì–ì
                    if (parseInt(parts[0]) > 12) {
                        // –î–î.–ú–ú.–ì–ì–ì–ì
                        day = parts[0].padStart(2, '0');
                        month = parts[1].padStart(2, '0');
                        year = parts[2];
                    } else if (parseInt(parts[1]) > 12) {
                        // –ú–ú.–î–î.–ì–ì–ì–ì
                        day = parts[1].padStart(2, '0');
                        month = parts[0].padStart(2, '0');
                        year = parts[2];
                    } else {
                        // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º –î–î.–ú–ú.–ì–ì–ì–ì
                        day = parts[0].padStart(2, '0');
                        month = parts[1].padStart(2, '0');
                        year = parts[2];
                    }
                } else if (parts[2].length === 2) {
                    // –î–î.–ú–ú.–ì–ì
                    day = parts[0].padStart(2, '0');
                    month = parts[1].padStart(2, '0');
                    year = '20' + parts[2];
                } else {
                    return dateString;
                }
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–∞—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                const date = new Date(year, month - 1, day);
                if (isNaN(date.getTime())) {
                    return dateString;
                }
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì
                return `${day}.${month}.${year}`;
                
            } catch (error) {
                return dateString;
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–º–º
        function formatAmount(amountString) {
            try {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–æ
                const numberMatch = amountString.match(/[\d,\.]+/);
                if (!numberMatch) return amountString;
                
                let number = numberMatch[0].replace(/,/g, '');
                const numberValue = parseFloat(number);
                
                if (isNaN(numberValue)) return amountString;
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å –∑–∞–ø—è—Ç—ã–º–∏ –¥–ª—è —Ç—ã—Å—è—á
                const formattedNumber = numberValue.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å –≤–∞–ª—é—Ç–æ–π
                return `${formattedNumber} USD`;
                
            } catch (error) {
                return amountString;
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        function formatPhone(phoneString) {
            try {
                // –£–±–∏—Ä–∞–µ–º –≤—Å–µ —Å–∏–º–≤–æ–ª—ã –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
                const digits = phoneString.replace(/\D/g, '');
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–ª–∏–Ω—ã
                if (digits.length === 11 && digits.startsWith('1')) {
                    // +1 (XXX) XXX-XXXX
                    return `+1 (${digits.slice(1, 4)}) ${digits.slice(4, 7)}-${digits.slice(7)}`;
                } else if (digits.length === 10) {
                    // (XXX) XXX-XXXX
                    return `(${digits.slice(0, 3)}) ${digits.slice(3, 6)}-${digits.slice(6)}`;
                } else if (digits.length === 7) {
                    // XXX-XXXX
                    return `${digits.slice(0, 3)}-${digits.slice(3)}`;
                }
                
                return phoneString;
                
            } catch (error) {
                return phoneString;
            }
        }

        // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
        function showDebugInfo() {
            if (!documentData) {
                showStatus('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç', 'error');
                return;
            }

            const debugInfo = analyzeDocument();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏
            document.getElementById('preview').innerHTML = `
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px;">
                    <h3 style="color: #495057; margin-bottom: 15px;">üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>–ù–∞–π–¥–µ–Ω–æ –∂–µ–ª—Ç—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</strong> ${debugInfo.yellowElements} –∏–∑ ${debugInfo.totalElements}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>–ù–∞–π–¥–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</strong> ${debugInfo.images}
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>–°—Ç–∏–ª–∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è:</strong>
                        <ul style="margin-left: 20px;">
                            <li>–ü–æ —Ü–µ–Ω—Ç—Ä—É: ${debugInfo.centerAligned}</li>
                            <li>–ü–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é: ${debugInfo.leftAligned}</li>
                            <li>–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é: ${debugInfo.rightAligned}</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</strong>
                        <ul style="margin-left: 20px;">
                            <li>–ê–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${autoFormatEnabled ? '–í–ö–õ' : '–í–´–ö–õ'}</li>
                            <li>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${preserveOriginalFormat ? '–í–ö–õ' : '–í–´–ö–õ'}</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <strong>–ù–∞–π–¥–µ–Ω–Ω—ã–µ –∂–µ–ª—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</strong>
                        <pre style="background: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 10px; font-size: 12px; max-height: 200px; overflow-y: auto;">${debugInfo.yellowElementsDetails}</pre>
                    </div>
                    
                    <button onclick="updatePreview()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                        üîÑ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
                    </button>
                </div>
            `;
        }

        // –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
        function analyzeDocument() {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = documentData.html;
            
            const allElements = tempDiv.querySelectorAll('*');
            const images = tempDiv.querySelectorAll('img');
            
            let yellowElements = 0;
            let centerAligned = 0;
            let leftAligned = 0;
            let rightAligned = 0;
            let yellowElementsDetails = [];
            
            allElements.forEach(element => {
                const style = element.style;
                const computedStyle = window.getComputedStyle(element);
                
                // –ü–æ–¥—Å—á–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
                if (style.textAlign === 'center' || computedStyle.textAlign === 'center') {
                    centerAligned++;
                } else if (style.textAlign === 'left' || computedStyle.textAlign === 'left') {
                    leftAligned++;
                } else if (style.textAlign === 'right' || computedStyle.textAlign === 'right') {
                    rightAligned++;
                }
                
                // –ü–æ–∏—Å–∫ –∂–µ–ª—Ç—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                if (style.backgroundColor === 'yellow' || 
                    style.backgroundColor === '#ffff00' || 
                    style.backgroundColor === '#ffc107' ||
                    computedStyle.backgroundColor === 'yellow' ||
                    computedStyle.backgroundColor === 'rgb(255, 255, 0)' ||
                    computedStyle.backgroundColor === 'rgb(255, 193, 7)') {
                    yellowElements++;
                    yellowElementsDetails.push({
                        tag: element.tagName,
                        text: element.textContent.substring(0, 50),
                        style: style.cssText || 'no inline styles',
                        computed: computedStyle.backgroundColor
                    });
                }
            });
            
            return {
                totalElements: allElements.length,
                yellowElements: yellowElements,
                images: images.length,
                centerAligned: centerAligned,
                leftAligned: leftAligned,
                rightAligned: rightAligned,
                yellowElementsDetails: JSON.stringify(yellowElementsDetails, null, 2)
            };
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = message ? 'block' : 'none';
            
            if (message && type === 'success') {
                setTimeout(() => {
                    status.style.display = 'none';
                }, 3000);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', function() {
            // –ñ–¥–µ–º 1 —Å–µ–∫—É–Ω–¥—É, —á—Ç–æ–±—ã —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å
            setTimeout(() => {
                loadDefaultDocument();
            }, 1000);
        });
    </script>
</body>
</html>
