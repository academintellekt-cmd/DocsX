<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏</title>
    <!-- SheetJS –¥–ª—è —á—Ç–µ–Ω–∏—è Excel —Ñ–∞–π–ª–æ–≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Docx.js –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è DOCX —Ñ–∞–π–ª–æ–≤ -->
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ docx –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É docx –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.addEventListener('load', function() {
            if (typeof docx === 'undefined') {
                console.warn('DOCX library not loaded, trying alternative source...');
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js';
                script.onload = () => console.log('DOCX library loaded from cdnjs');
                script.onerror = () => console.error('Failed to load DOCX from cdnjs');
                document.head.appendChild(script);
            } else {
                console.log('DOCX library loaded successfully');
            }
        });
    </script>
    <!-- FileSaver.js –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .form-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .preview-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .preview-section h2 {
            color: #333;
            margin-bottom: 25px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .contract-preview {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            max-height: 1500px;
            overflow-y: auto;
            font-family: 'Times New Roman', serif;
            font-size: 11px;
            line-height: 1.3;
        }

        .contract-preview h3 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: bold;
        }

        .contract-preview p {
            margin-bottom: 10px;
            text-align: justify;
        }

        .highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .download-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            margin-top: 20px;
        }

        .download-btn:hover {
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìÑ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏ –æ–Ω–ª–∞–π–Ω</p>
        </div>
        
        <div class="main-content">
            <div class="form-section">
                <h2>üìù –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä–∞</h2>
                
                <form id="contractForm">
                    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä–∞ -->
                    <h3 style="color: #667eea; margin-bottom: 15px; border-bottom: 2px solid #667eea; padding-bottom: 5px;">üìã –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                    
                    <div class="form-group">
                        <label for="agreementDate">–î–∞—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞:</label>
                        <input type="date" id="agreementDate" name="agreementDate">
                    </div>
                    
                    <div class="form-group">
                        <label for="agreementNumber">–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞:</label>
                        <input type="text" id="agreementNumber" name="agreementNumber" value="25.09.04">
                        <small style="color: #666; font-size: 11px;">–ù–æ–º–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç—ã (–≥–æ–¥.–º–µ—Å—è—Ü.–¥–µ–Ω—å)</small>
                    </div>
                    
                    
                    <div class="form-group">
                        <label for="customerName">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑—á–∏–∫–∞:</label>
                        <input type="text" id="customerName" name="customerName" value="Mindtrix LLC">
                    </div>
                    
                    <!-- –£—Å–ª–æ–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ -->
                    <h3 style="color: #667eea; margin: 25px 0 15px 0; border-bottom: 2px solid #667eea; padding-bottom: 5px;">üí∞ –£—Å–ª–æ–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞</h3>
                    
                    <div class="form-group">
                        <label for="workDescription">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç:</label>
                        <textarea id="workDescription" name="workDescription" rows="4">Prepare equipment for escape room;
Prepare decoration for escape room;
Prepare a separate modules according to the Specification to this agreement;
To pass the result of works to the Customer;</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="deadlineDays">–°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (–¥–Ω–µ–π):</label>
                        <input type="number" id="deadlineDays" name="deadlineDays" value="90">
                    </div>
                    
                    <div class="form-group">
                        <label for="contractPrice">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–≥–æ–≤–æ—Ä–∞:</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="contractPrice" name="contractPrice" value="10000" style="flex: 1;">
                            <select id="currency" name="currency" style="width: 80px;">
                                <option value="USD">USD</option>
                                <option value="EUR">EUR</option>
                            </select>
                    </div>
                    </div>
                    
                    
                    <div class="form-group">
                        <label for="paymentTerms">–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã:</label>
                        <input type="text" id="paymentTerms" name="paymentTerms" value="in the amount of 100% of the Contract value within 3 working days">
                    </div>
                    
                    <!-- –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∞ -->
                    <h3 style="color: #667eea; margin: 25px 0 15px 0; border-bottom: 2px solid #667eea; padding-bottom: 5px;">üë§ –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∞</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerAddress">–ê–¥—Ä–µ—Å –∑–∞–∫–∞–∑—á–∏–∫–∞:</label>
                            <input type="text" id="customerAddress" name="customerAddress" value="4155 Mapleton Drive">
                        </div>
                    <div class="form-group">
                            <label for="customerCity">–ì–æ—Ä–æ–¥, —à—Ç–∞—Ç, –∏–Ω–¥–µ–∫—Å:</label>
                            <input type="text" id="customerCity" name="customerCity" value="West Linn, OR 97068">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customerPhone">–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–∫–∞–∑—á–∏–∫–∞:</label>
                            <input type="text" id="customerPhone" name="customerPhone" value="+1 (229) 563-4204">
                        </div>
                    <div class="form-group">
                            <label for="customerEmail">Email –∑–∞–∫–∞–∑—á–∏–∫–∞:</label>
                            <input type="email" id="customerEmail" name="customerEmail" value="mike@mindtrixescape.com">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="customerSignatory">–ü–æ–¥–ø–∏—Å–∞–Ω—Ç –∑–∞–∫–∞–∑—á–∏–∫–∞:</label>
                        <input type="text" id="customerSignatory" name="customerSignatory" value="Mike Walker">
                    </div>
                    
                    <!-- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è -->
                    <h3 style="color: #667eea; margin: 25px 0 15px 0; border-bottom: 2px solid #667eea; padding-bottom: 5px;">üìÑ –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è</h3>
                    
                    <div class="form-group">
                        <label for="specificationFile">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:</label>
                        <input type="file" id="specificationFile" name="specificationFile" accept=".html,.htm,.xls,.xlsx" onchange="loadSpecification()">
                        <small style="color: #666; font-size: 12px;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã .html/.htm/.xls/.xlsx</small>
                    </div>
                    
                    <div id="specificationPreview" style="display: none; margin-top: 15px; padding: 15px; background: #e8f5e8; border-radius: 6px; border: 1px solid #4caf50;">
                        <p style="color: #2e7d32; font-weight: 600; margin: 0;">‚úì –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞</p>
                    </div>
                    
                    <button type="button" class="btn download-btn" onclick="downloadContractNew()">üíæ –°–∫–∞—á–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä (DOCX)</button>
                    <button type="button" class="btn download-btn" onclick="testDocxExport()">üß™ –¢–µ—Å—Ç DOCX</button>
                </form>
            </div>
            
            <div class="preview-section">
                <h2>üëÅÔ∏è –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä</h2>
                <div id="contractPreview" class="contract-preview">
                    <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–æ–≥–æ–≤–æ—Ä -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ –∏–∑ –¥–∞—Ç—ã
        function generateContractNumber(dateString) {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            
            return `${year}.${month}.${day}`;
        }

        // –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–∏—Å–µ–ª –±–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π —Ç—ã—Å—è—á
        function formatNumber(num) {
            return num.toString();
        }

        // –§—É–Ω–∫—Ü–∏—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —á–∏—Å–µ–ª –≤ —Å–ª–æ–≤–∞ (–¥–æ 500000)
        function numberToWords(num) {
            if (num === 0) return 'zero';
            if (num > 500000) return num.toString(); // –ï—Å–ª–∏ –±–æ–ª—å—à–µ 500000, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∏—Å–ª–æ
            
            const ones = ['', 'one', 'two', 'three', 'four', 'five', 'six', 'seven', 'eight', 'nine'];
            const teens = ['ten', 'eleven', 'twelve', 'thirteen', 'fourteen', 'fifteen', 'sixteen', 'seventeen', 'eighteen', 'nineteen'];
            const tens = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
            const thousands = ['', 'thousand', 'million'];
            
            function convertHundreds(n) {
                let result = '';
                if (n > 99) {
                    result += ones[Math.floor(n / 100)] + ' hundred';
                    n %= 100;
                    if (n > 0) result += ' ';
                }
                if (n > 19) {
                    result += tens[Math.floor(n / 10)];
                    n %= 10;
                    if (n > 0) result += '-' + ones[n];
                } else if (n > 9) {
                    result += teens[n - 10];
                } else if (n > 0) {
                    result += ones[n];
                }
                return result;
            }
            
            let result = '';
            let thousandIndex = 0;
            
            while (num > 0) {
                const chunk = num % 1000;
                if (chunk !== 0) {
                    const chunkWords = convertHundreds(chunk);
                    if (thousandIndex > 0) {
                        result = chunkWords + ' ' + thousands[thousandIndex] + (result ? ' ' + result : '');
                    } else {
                        result = chunkWords;
                    }
                }
                num = Math.floor(num / 1000);
                thousandIndex++;
            }
            
            return result;
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date();
            const formattedDate = today.toISOString().split('T')[0];
            document.getElementById('agreementDate').value = formattedDate;
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞
            const contractNumber = generateContractNumber(formattedDate);
            document.getElementById('agreementNumber').value = contractNumber;
            
            
            generateContract(); // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–æ–≥–æ–≤–æ—Ä –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞—Ç—ã
        document.getElementById('agreementDate').addEventListener('change', function() {
            const contractNumber = generateContractNumber(this.value);
            document.getElementById('agreementNumber').value = contractNumber;
            generateContract();
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–≥–æ–≤–æ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—É–º–º—ã –∏ –≤–∞–ª—é—Ç—ã
        document.getElementById('contractPrice').addEventListener('input', function() {
            generateContract();
        });
        
        document.getElementById('currency').addEventListener('change', function() {
            generateContract();
        });

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞
        function loadSpecification() {
            const fileInput = document.getElementById('specificationFile');
            const file = fileInput.files[0];
            
            if (file) {
                const fileName = file.name.toLowerCase();
                const reader = new FileReader();
                
                if (fileName.endsWith('.html') || fileName.endsWith('.htm')) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Ñ–∞–π–ª–æ–≤
                reader.onload = function(e) {
                    const content = e.target.result;
                    
                    // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏–∑ HTML —Ñ–∞–π–ª–∞
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    
                    // –ù–∞—Ö–æ–¥–∏–º —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
                    const tables = doc.querySelectorAll('table');
                    const bodyContent = doc.body.innerHTML;
                    
                    let specificationHTML = '';
                    
                    if (tables.length > 0) {
                        // –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
                        tables.forEach(table => {
                            specificationHTML += table.outerHTML;
                        });
                    } else {
                        // –ò–Ω–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç
                        specificationHTML = bodyContent;
                    }
                    
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                    document.getElementById('specificationPreview').style.display = 'block';
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥–æ–≥–æ–≤–æ—Ä–µ
                    window.loadedSpecification = specificationHTML;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–≥–æ–≤–æ—Ä
                    generateContract();
                };
                reader.readAsText(file);
                } else if (fileName.endsWith('.xls') || fileName.endsWith('.xlsx')) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ Excel —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SheetJS
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            
                            // –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            
                            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ JSON
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
                            let maxColumns = 0;
                            for (let i = 0; i < jsonData.length; i++) {
                                if (jsonData[i] && jsonData[i].length > maxColumns) {
                                    maxColumns = jsonData[i].length;
                                }
                            }
                            
                            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∫–æ–ª–æ–Ω–æ–∫
                            let tableHTML = `<table style="width: 100%; border-collapse: collapse; margin-top: 20px; border: 2px solid #000;">`;
                            
                            let hasData = false;
                            
                            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Excel - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –µ—Å—Ç—å
                            for (let i = 0; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                
                                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                                if (!row || row.length === 0 || row.every(cell => !cell || cell.toString().trim() === '')) {
                                    continue;
                                }
                                
                                hasData = true;
                                tableHTML += '<tr>';
                                
                                // –î–æ–±–∞–≤–ª—è–µ–º —è—á–µ–π–∫–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–æ–ª–æ–Ω–æ–∫
                                for (let j = 0; j < maxColumns; j++) {
                                    const cellValue = row[j] || '';
                                    const cellStyle = 'border: 1px solid #000; padding: 8px;';
                                    
                                    // –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ - –¥–µ–ª–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
                                    if (i === 0 || (i === 1 && jsonData[0] && jsonData[0].every(cell => !cell || cell.toString().trim() === ''))) {
                                        tableHTML += `<th style="${cellStyle} background-color: #f5f5f5;">${cellValue}</th>`;
            } else {
                                        tableHTML += `<td style="${cellStyle}">${cellValue}</td>`;
                                    }
                                }
                                
                                tableHTML += '</tr>';
                            }
                            
                            tableHTML += '</table>';
                            
                            // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                            if (!hasData) {
                                tableHTML = `
                                    <table style="width: 100%; border-collapse: collapse; margin-top: 20px; border: 2px solid #000;">
                                        <tr>
                                            <td style="border: 1px solid #000; padding: 20px; text-align: center; color: #666;">
                                                Excel —Ñ–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤—Å–µ —è—á–µ–π–∫–∏ –ø—É—Å—Ç—ã–µ.
                                            </td>
                                        </tr>
                                    </table>`;
                            }
                            
                            
                            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
                            document.getElementById('specificationPreview').style.display = 'block';
                            
                            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥–æ–≥–æ–≤–æ—Ä–µ
                            window.loadedSpecification = tableHTML;
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–≥–æ–≤–æ—Ä
                            generateContract();
                        } catch (error) {
                            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ Excel —Ñ–∞–π–ª–∞: ' + error.message);
                            console.error('Excel parsing error:', error);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ (.html, .htm, .xls, .xlsx)');
                }
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
            }
        }

        function generateContract() {
            const form = document.getElementById('contractForm');
            const formData = new FormData(form);
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–æ—Ä–º—ã
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const date = new Date(data.agreementDate);
            const formattedDate = date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π HTML –¥–æ–≥–æ–≤–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É
            const contractHTML = `
                <div style="text-align: center; font-weight: bold; margin-bottom: 20px;">
                    AGREEMENT ‚Ññ <span class="highlight">${data.agreementNumber}</span>
</div>

                <div style="text-align: right; margin-bottom: 20px;">
                    <span class="highlight">${formattedDate}</span>
</div>

                <p><strong><span class="highlight">${data.customerName}</span></strong>, hereinafter referred to as the "Customer" on the one hand and <strong>Time Quest Lab LLC</strong>, hereinafter referred to as the "Executor" on the other hand, together referred to as the "Parties", have finalized the present Agreement, as follows:</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">1. SUBJECT OF AGREEMENT</h3>

<p>1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:</p>
                <div style="margin-left: 20px;">
                    ${data.workDescription.split('\n').map(line => `<p>- ${line.trim()}</p>`).join('')}
                </div>
                <p>and the Customer shall accept the result of work performed and pay for them in the order provided herein.</p>

<p>1.2. The occurrence, exercise and protection of copyright on the result of executed works does not require registration or compliance with any other formalities. Intellectual property rights on the work belong to the Executor in full.</p>

<p>1.3. The price of the Agreement does not include expenses associated with the packaging and transportation of equipment, and they are paid by the Customer separately.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">2. TERMS</h3>

                <p>2.1. Executor undertakes to perform the work in accordance with p. 1.1. of this Agreement in the following terms:</p>
                <p>2.1.1. The deadline for the work is <span class="highlight">${data.deadlineDays} calendar days</span> from the date the Executor receives the advance payment.</p>

                <p>2.2. Executor if necessary or if there is a valid reason can be given an additional grace period agreed upon with the Customer, but not less than seven business days. These reasons include: violation of the terms of delivery by postal and courier services of components required for the manufacture of tools and devices for the technical implementation of the scenario solution, supply of defect components, preventing the production of equipment and devices for the technical implementation of the scenario solution, the deadline for completion of the works.</p>

<p>2.3. Executor in writing, as provided for n. 9.3. of this Agreement, informs the Customer about the need to provide him the grace period for the completion of works.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">3. PRICE OF WORK AND PAYMENT</h3>

                <p>3.1. The total Agreement price is <span class="highlight">$${formatNumber(parseInt(data.contractPrice) || 0)} (${numberToWords(parseInt(data.contractPrice) || 0)}) ${data.currency === 'EUR' ? 'euros' : 'US dollars'}</span>.</p>
                <p>3.2. Payment is made by the Customer <span class="highlight">${data.paymentTerms}</span> from the date of notification of the Contractor about the readiness of the package.</p>
<p>3.3. Payment under this Agreement shall be made by the Customer by non-cash payment to the Executor's current account.</p>
<p>3.4. The obligation of the Customer to pay the price of the Agreement shall be considered fulfilled when the funds are credited to the account of the Executor, unless the Parties agree otherwise.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">4. RIGHTS AND OBLIGATIONS OF THE PARTIES</h3>

<p>4.1. Executor undertakes to:</p>
<p>4.1.1. Carry out work in accordance with the terms of this Agreement and submit the result of work to the Customer.</p>
                <p>4.1.2. Carry out work at the agreed time.</p>
                <p>4.1.3. In carrying out work under the Agreement not to violate the intellectual property rights of third parties.</p>
                <p>4.1.4. Within six months from the moment of receiving the equipment, the customer is provided with technical and consulting online support during the installation and setting up of the equipment.</p>
                <p>Free of charge: phone consultations on the "hot line" on business days from 3:00 to 12:00 (UTC), "hot line" phone number - +7-913-747-34-91 (WhatsApp).</p>
                <p>Paid: phone consultations on the "hot line" on any day and at any time. The price for 1 hour is $ 40. The hotline phone number is + 7-913-747-34-91 (WhatsApp).</p>

                <p>4.2. Executor has right to:</p>
                <p>4.2.1. Not proceeding with the work, if the Customer does not list the advance payment and the terms set forth herein. In this case, the deadline for the work by the Executor begins to run from the day following the date of receipt of its settlement account the entire amount of the advance payment.</p>

<p>4.3. Customer undertakes to:</p>
                <p>4.3.1. Accept and pay for the result of the Executor's work in the manner and terms set forth herein.</p>
                <p>4.3.2. Use the result of the work only in his commercial activities.</p>
                <p>4.3.3. Transfer to the Executor at the time of the conclusion of this Agreement the necessary technical documentation available in his possession: the plan of the room with dimensions (ceiling height, exact dimensions of all rooms, wall thickness).</p>
                <p>4.3.4. After completion of the construction of the escape room, upon request, provide the Executor with photo and video materials on the work done for posting on the website and in social networks for marketing purposes.</p>
                <p>4.3.5. The Customer must provide photos and video materials of the finished escape rooms within a specific period (two weeks) after launch. Otherwise, the Executor has the right not to provide technical support in accordance with clause 4.1.4.</p>

<p>4.4. Customer has right to:</p>
                <p>4.4.1. In unilaterally withdraw from the execution of this Agreement, after one month's written notice to the Executor and to pay him the actual costs incurred.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">5. ORDER ACCEPTANCE RESULT OF WORK</h3>

                <p>5.1. Acceptance of the result of the work performed is made by the Parties on the basis of Certificate of Delivery and Acceptance. The result of the work shall be deemed accepted by the Customer at the time of signing the Certificate of Delivery and Acceptance.</p>
<p>5.2. The Customer is obliged to accept and test the result of work and sign the Certificate of Delivery and Acceptance, within three business days of notification by the Executor of the work readiness.</p>
                <p>5.3. The result of the work and installation work is considered accepted after three business days after notification by the Executor of the readiness of works if the –°ustomer refuses to accept the result of the work and the signing of the Certificate of Delivery and Acceptance, without providing a written reasoned refusal within one working day.</p>
                <p>5.4. The Customer must notify Executor of the obvious shortcomings in the works at the time of signing the Certificate of Delivery and Acceptance. Executor undertakes on his own and at his own expense to eliminate obvious defects in the works. If the Customer fails to notify Executor about presence of obvious deficiencies within the period specified in the agreement, he loses the right to rely on them in the future.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">6. CONFIDENTIALITY</h3>

                <p>6.1. The Parties undertake not to disclose confidential information that has become known to them during the execution of this Agreement.</p>
                <p>6.2. By "confidential information" within the meaning of the Agreement the following information is assigned:</p>
                <p>- information on technical, programmatic and technological developments and solutions;</p>
                <p>- information about the financial status of the Parties, the size of the profits, as well as other financial account information;</p>
                <p>- information related to the management: used developments and management solutions, ways of doing things, tactics and strategy of management, etc.;</p>
                <p>- information about past, present and potential clients and partners;</p>
                <p>- information on employees;</p>
                <p>- other information, disclosure, transfer or leakage of which could damage the interests of each of the Parties;</p>
                <p>- information about the content and material conditions of the execution of this Agreement by the Parties.</p>
                <p>6.3. Under the "disclosure of confidential information" within the meaning of this Agreement must be understood:</p>
                <p>- transfer to third parties of the relevant documents containing confidential information, including with the use of e-mail, facsimile, electronic mail (e-mail), via the Internet, as well as by any other means, to identify the contents of the relevant documents;</p>
                <p>- transfer to third parties of the information related to confidential information, in oral or written form, including with the use of a telephone, mail, facsimile, electronic mail (e-mail), via the Internet, as well as in any other way, allowing the identification of the content of the relevant information;</p>
                <p>- made in any other way bringing to the attention of third parties of the confidential information of each of the Parties.</p>
                <p>6.4. In case of unfair use or disclosure of confidential information, the injured party is entitled to demand compensation for damages caused to it because of such an unfair use or disclosure of confidential information.</p>
                <p>6.5. The parties mutually undertake to store provided by the other party relating to the subject matter of this Agreement documents and business papers in a place adapted for this, as well as let only authorized people work with them.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">7. RESPONSIBILITY OF THE PARTIES</h3>

<p>7.1. The Customer has the right to submit Executor a request for payment of the penalty of 0.1% of the price of work for each day of delay, but not more than 10% of the cost of works in case of violation by the Executor the agreed period of performance.</p>
                <p>7.2. For non-fulfillment or improper fulfillment of other duties under this Agreement the Parties bear responsibility established by the legislation of Armenia.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">8. FORCE MAJEURE</h3>

                <p>8.1. Parties are not responsible for complete or partial failure to fulfill obligations under this Agreement if such failure will be the result of force majeure, which include riots, prohibitive actions of the authorities, natural disasters, fires, accidents or other force majeure.</p>
                <p>8.2. The Parties shall notify in writing each other about the existence of force majeure, within 5 (five) days from the date of their occurrence.</p>
                <p>8.3. If the existence of such force majeure circumstances directly affected the performance of the Parties' obligations within the period specified in this Agreement, the time limits are extended for the duration of the relevant circumstances.</p>
                <p>8.4. If the impossibility of performance of the Parties' obligations under this Agreement will last more than one (1) month, the Parties may terminate this Agreement, followed by settlements, without the obligation to compensate for potential losses.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">9. OTHER CONDITIONS</h3>

                <p>9.1. This Agreement shall enter into force on the date of its signing and is valid until the Parties fulfill their obligations hereunder.</p>
                <p>9.2. All changes and additions to this Agreement must be made in writing and signed by the Parties.</p>
                <p>9.3. The parties recognize legal force and consider the Agreement, specifications to it, additional agreements, acts, notifications about the readiness of the Executor's work result as well as notice of the need to provide a grace period for completion of work, claims submitted by fax or e-mail, written documents, if there is the ability to reliably establish that the document comes precisely from the Party according to the Agreement.</p>
                <p>All other notifications and notices related to the execution of this Agreement shall be sent by the Parties in a letter with acknowledgment of receipt or shall be delivered to the Party concerned with the express.</p>
                <p>9.4. This Agreement may be terminated on the grounds and in the manner established by the legislation of Armenia.</p>
                <p>9.5. In all that is not provided in this Agreement Parties shall follow the applicable Armenia.</p>
                <p>9.6. The Parties shall resolve through negotiations all disputes arising during the execution of this Agreement.</p>
                <p>In case no agreement is reached by negotiation, the Party concerned sends a written claim to the other party by fax or by e-mail or by courier mail. The term of consideration of the claim is five business days from the date of its receipt.</p>
                <p>9.7. This Agreement is made in two copies having equal legal force, one copy for each Party.</p>

                <h3 style="margin-top: 20px; margin-bottom: 10px;">10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES</h3>

                <div style="margin-top: 20px;">
                    <h4>Customer</h4>
                    <p><strong><span class="highlight">${data.customerName}</span></strong></p>
                    <p><span class="highlight">${data.customerAddress}</span></p>
                    <p><span class="highlight">${data.customerCity}</span></p>
                    <p><span class="highlight">${data.customerPhone}</span></p>
                    <p><span class="highlight">${data.customerEmail}</span></p>
                    <p>__________________/<span class="highlight">${data.customerSignatory}</span></p>
                    <p>Stamp</p>
</div>

                <div style="margin-top: 30px;">
                    <h4>Executor</h4>
<p><strong>Time Quest Lab LLC</strong></p>
<p>Certificate of State registration: 269.110.1255490</p>
<p>Tax ID: 1702302685</p>
                    <p>Address: Armenia, Yerevan, 9 May str., 51/ 27</p>
                    <p>Phone number: +374 98171651</p>
                    <p>email: vasilypetrenko91@gmail.com</p>
                    <p><strong>USD</strong></p>
                    <p>Beneficiary bank: ARDSHINBANK</p>
                    <p>Bank address: Yerevan, Grigor Lusavorich 13</p>
                    <p>tel.: (+37410) 569660</p>
                    <p>SWIFT code: ASHBAM22</p>
                    <p>Account #: 2474402605340010</p>
<p>___________________/Petrenko V.A.</p>
</div>

                <div style="margin-top: 40px; border-top: 2px solid #ccc; padding-top: 20px;">
                    <h3>Appendix No. 1. Specification for the Agreement # ${data.agreementNumber} from ${formattedDate}</h3>
                    
                    ${window.loadedSpecification ? `
                        <div style="margin-top: 20px;">
                            ${window.loadedSpecification}
                        </div>
                    ` : `
                        <p style="color: #666; font-style: italic;">–ú–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞</p>
                    `}
                    
                    <div style="width: 100%; display: flex; margin-top: 20px;">
                        <div style="width: 50%; padding: 10px;">
                                    <p><strong>Customer</strong></p>
                                    <p><span class="highlight">${data.customerName}</span></p>
                                    <p>__________________/<span class="highlight">${data.customerSignatory}</span></p>
                        </div>
                        <div style="width: 50%; padding: 10px;">
                                    <p><strong>Executor</strong></p>
                                    <p>Time Quest Lab LLC</p>
                                    <p>___________________/Petrenko V.A.</p>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('contractPreview').innerHTML = contractHTML;
        }

        async function downloadContract() {
            const form = document.getElementById('contractForm');
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const date = new Date(data.agreementDate);
            const formattedDate = date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å docx –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                if (typeof docx === 'undefined') {
                    console.error('DOCX library not loaded, attempting to load...');
                    await loadDocxLibrary();
                    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    if (typeof docx === 'undefined') {
                        throw new Error('Failed to load docx library');
                    }
                }
                
                console.log('docx library loaded successfully');
                
                // –°–æ–∑–¥–∞–µ–º DOCX –¥–æ–∫—É–º–µ–Ω—Ç –±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏–π
                const { Document, Packer, Paragraph, HeadingLevel, AlignmentType } = docx;
                
                console.log('Available docx components:', { Document, Packer, Paragraph, HeadingLevel, AlignmentType });

                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ)
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: [
                            new Paragraph({
                                text: `AGREEMENT ‚Ññ ${data.agreementNumber}`,
                                heading: HeadingLevel.TITLE,
                                alignment: AlignmentType.CENTER,
                            }),
                            new Paragraph({
                                text: formattedDate,
                                alignment: AlignmentType.RIGHT,
                            }),
                            new Paragraph({
                                text: `${data.customerName}, hereinafter referred to as the "Customer" on the one hand and Time Quest Lab LLC, hereinafter referred to as the "Executor" on the other hand, together referred to as the "Parties", have finalized the present Agreement, as follows:`,
                            }),
                            new Paragraph({
                                text: "1. SUBJECT OF AGREEMENT",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:",
                            }),
                            new Paragraph({
                                text: data.workDescription.split('\n').map(line => `- ${line.trim()}`).join('\n'),
                            }),
                            new Paragraph({
                                text: "and the Customer shall accept the result of work performed and pay for them in the order provided herein.",
                            }),
                            new Paragraph({
                                text: "1.2. The occurrence, exercise and protection of copyright on the result of executed works does not require registration or compliance with any other formalities. Intellectual property rights on the work belong to the Executor in full.",
                            }),
                            new Paragraph({
                                text: "1.3. The price of the Agreement does not include expenses associated with the packaging and transportation of equipment, and they are paid by the Customer separately.",
                            }),
                            new Paragraph({
                                text: "2. TERMS",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "2.1. Executor undertakes to perform the work in accordance with p. 1.1. of this Agreement in the following terms:",
                            }),
                            new Paragraph({
                                text: `2.1.1. The deadline for the work is ${data.deadlineDays} calendar days from the date the Executor receives the advance payment.`,
                            }),
                            new Paragraph({
                                text: "2.2. Executor if necessary or if there is a valid reason can be given an additional grace period agreed upon with the Customer, but not less than seven business days. These reasons include: violation of the terms of delivery by postal and courier services of components required for the manufacture of tools and devices for the technical implementation of the scenario solution, supply of defect components, preventing the production of equipment and devices for the technical implementation of the scenario solution, the deadline for completion of the works.",
                            }),
                            new Paragraph({
                                text: "2.3. Executor in writing, as provided for n. 9.3. of this Agreement, informs the Customer about the need to provide him the grace period for the completion of works.",
                            }),
                            new Paragraph({
                                text: "3. PRICE OF WORK AND PAYMENT",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: `3.1. The total Agreement price is $${formatNumber(parseInt(data.contractPrice) || 0)} (${numberToWords(parseInt(data.contractPrice) || 0)}) ${data.currency === 'EUR' ? 'euros' : 'US dollars'}.`,
                            }),
                            new Paragraph({
                                text: `3.2. Payment is made by the Customer ${data.paymentTerms} from the date of notification of the Contractor about the readiness of the package.`,
                            }),
                            new Paragraph({
                                text: "3.3. Payment under this Agreement shall be made by the Customer by non-cash payment to the Executor's current account.",
                            }),
                            new Paragraph({
                                text: "3.4. The obligation of the Customer to pay the price of the Agreement shall be considered fulfilled when the funds are credited to the account of the Executor, unless the Parties agree otherwise.",
                            }),
                            new Paragraph({
                                text: "4. RIGHTS AND OBLIGATIONS OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "4.1. Executor undertakes to:",
                            }),
                            new Paragraph({
                                text: "4.1.1. Carry out work in accordance with the terms of this Agreement and submit the result of work to the Customer.",
                            }),
                            new Paragraph({
                                text: "4.1.2. Carry out work at the agreed time.",
                            }),
                            new Paragraph({
                                text: "4.1.3. In carrying out work under the Agreement not to violate the intellectual property rights of third parties.",
                            }),
                            new Paragraph({
                                text: "4.1.4. Within six months from the moment of receiving the equipment, the customer is provided with technical and consulting online support during the installation and setting up of the equipment.",
                            }),
                            new Paragraph({
                                text: "Free of charge: phone consultations on the \"hot line\" on business days from 3:00 to 12:00 (UTC), \"hot line\" phone number - +7-913-747-34-91 (WhatsApp).",
                            }),
                            new Paragraph({
                                text: "Paid: phone consultations on the \"hot line\" on any day and at any time. The price for 1 hour is $ 40. The hotline phone number is + 7-913-747-34-91 (WhatsApp).",
                            }),
                            new Paragraph({
                                text: "4.2. Executor has right to:",
                            }),
                            new Paragraph({
                                text: "4.2.1. Not proceeding with the work, if the Customer does not list the advance payment and the terms set forth herein. In this case, the deadline for the work by the Executor begins to run from the day following the date of receipt of its settlement account the entire amount of the advance payment.",
                            }),
                            new Paragraph({
                                text: "4.3. Customer undertakes to:",
                            }),
                            new Paragraph({
                                text: "4.3.1. Accept and pay for the result of the Executor's work in the manner and terms set forth herein.",
                            }),
                            new Paragraph({
                                text: "4.3.2. Use the result of the work only in his commercial activities.",
                            }),
                            new Paragraph({
                                text: "4.3.3. Transfer to the Executor at the time of the conclusion of this Agreement the necessary technical documentation available in his possession: the plan of the room with dimensions (ceiling height, exact dimensions of all rooms, wall thickness).",
                            }),
                            new Paragraph({
                                text: "4.3.4. After completion of the construction of the escape room, upon request, provide the Executor with photo and video materials on the work done for posting on the website and in social networks for marketing purposes.",
                            }),
                            new Paragraph({
                                text: "4.3.5. The Customer must provide photos and video materials of the finished escape rooms within a specific period (two weeks) after launch. Otherwise, the Executor has the right not to provide technical support in accordance with clause 4.1.4.",
                            }),
                            new Paragraph({
                                text: "4.4. Customer has right to:",
                            }),
                            new Paragraph({
                                text: "4.4.1. In unilaterally withdraw from the execution of this Agreement, after one month's written notice to the Executor and to pay him the actual costs incurred.",
                            }),
                            new Paragraph({
                                text: "5. ORDER ACCEPTANCE RESULT OF WORK",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "5.1. Acceptance of the result of the work performed is made by the Parties on the basis of Certificate of Delivery and Acceptance. The result of the work shall be deemed accepted by the Customer at the time of signing the Certificate of Delivery and Acceptance.",
                            }),
                            new Paragraph({
                                text: "5.2. The Customer is obliged to accept and test the result of work and sign the Certificate of Delivery and Acceptance, within three business days of notification by the Executor of the work readiness.",
                            }),
                            new Paragraph({
                                text: "5.3. The result of the work and installation work is considered accepted after three business days after notification by the Executor of the readiness of works if the Customer refuses to accept the result of the work and the signing of the Certificate of Delivery and Acceptance, without providing a written reasoned refusal within one working day.",
                            }),
                            new Paragraph({
                                text: "5.4. The Customer must notify Executor of the obvious shortcomings in the works at the time of signing the Certificate of Delivery and Acceptance. Executor undertakes on his own and at his own expense to eliminate obvious defects in the works. If the Customer fails to notify Executor about presence of obvious deficiencies within the period specified in the agreement, he loses the right to rely on them in the future.",
                            }),
                            new Paragraph({
                                text: "6. CONFIDENTIALITY",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "6.1. The Parties undertake not to disclose confidential information that has become known to them during the execution of this Agreement.",
                            }),
                            new Paragraph({
                                text: "6.2. By \"confidential information\" within the meaning of the Agreement the following information is assigned:",
                            }),
                            new Paragraph({
                                text: "- information on technical, programmatic and technological developments and solutions;",
                            }),
                            new Paragraph({
                                text: "- information about the financial status of the Parties, the size of the profits, as well as other financial account information;",
                            }),
                            new Paragraph({
                                text: "- information related to the management: used developments and management solutions, ways of doing things, tactics and strategy of management, etc.;",
                            }),
                            new Paragraph({
                                text: "- information about past, present and potential clients and partners;",
                            }),
                            new Paragraph({
                                text: "- information on employees;",
                            }),
                            new Paragraph({
                                text: "- other information, disclosure, transfer or leakage of which could damage the interests of each of the Parties;",
                            }),
                            new Paragraph({
                                text: "- information about the content and material conditions of the execution of this Agreement by the Parties.",
                            }),
                            new Paragraph({
                                text: "6.3. Under the \"disclosure of confidential information\" within the meaning of this Agreement must be understood:",
                            }),
                            new Paragraph({
                                text: "- transfer to third parties of the relevant documents containing confidential information, including with the use of e-mail, facsimile, electronic mail (e-mail), via the Internet, as well as by any other means, to identify the contents of the relevant documents;",
                            }),
                            new Paragraph({
                                text: "- transfer to third parties of the information related to confidential information, in oral or written form, including with the use of a telephone, mail, facsimile, electronic mail (e-mail), via the Internet, as well as in any other way, allowing the identification of the content of the relevant information;",
                            }),
                            new Paragraph({
                                text: "- made in any other way bringing to the attention of third parties of the confidential information of each of the Parties.",
                            }),
                            new Paragraph({
                                text: "6.4. In case of unfair use or disclosure of confidential information, the injured party is entitled to demand compensation for damages caused to it because of such an unfair use or disclosure of confidential information.",
                            }),
                            new Paragraph({
                                text: "6.5. The parties mutually undertake to store provided by the other party relating to the subject matter of this Agreement documents and business papers in a place adapted for this, as well as let only authorized people work with them.",
                            }),
                            new Paragraph({
                                text: "7. RESPONSIBILITY OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "7.1. The Customer has the right to submit Executor a request for payment of the penalty of 0.1% of the price of work for each day of delay, but not more than 10% of the cost of works in case of violation by the Executor the agreed period of performance.",
                            }),
                            new Paragraph({
                                text: "7.2. For non-fulfillment or improper fulfillment of other duties under this Agreement the Parties bear responsibility established by the legislation of Armenia.",
                            }),
                            new Paragraph({
                                text: "8. FORCE MAJEURE",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "8.1. Parties are not responsible for complete or partial failure to fulfill obligations under this Agreement if such failure will be the result of force majeure, which include riots, prohibitive actions of the authorities, natural disasters, fires, accidents or other force majeure.",
                            }),
                            new Paragraph({
                                text: "8.2. The Parties shall notify in writing each other about the existence of force majeure, within 5 (five) days from the date of their occurrence.",
                            }),
                            new Paragraph({
                                text: "8.3. If the existence of such force majeure circumstances directly affected the performance of the Parties' obligations within the period specified in this Agreement, the time limits are extended for the duration of the relevant circumstances.",
                            }),
                            new Paragraph({
                                text: "8.4. If the impossibility of performance of the Parties' obligations under this Agreement will last more than one (1) month, the Parties may terminate this Agreement, followed by settlements, without the obligation to compensate for potential losses.",
                            }),
                            new Paragraph({
                                text: "9. OTHER CONDITIONS",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "9.1. This Agreement shall enter into force on the date of its signing and is valid until the Parties fulfill their obligations hereunder.",
                            }),
                            new Paragraph({
                                text: "9.2. All changes and additions to this Agreement must be made in writing and signed by the Parties.",
                            }),
                            new Paragraph({
                                text: "9.3. The parties recognize legal force and consider the Agreement, specifications to it, additional agreements, acts, notifications about the readiness of the Executor's work result as well as notice of the need to provide a grace period for completion of work, claims submitted by fax or e-mail, written documents, if there is the ability to reliably establish that the document comes precisely from the Party according to the Agreement.",
                            }),
                            new Paragraph({
                                text: "All other notifications and notices related to the execution of this Agreement shall be sent by the Parties in a letter with acknowledgment of receipt or shall be delivered to the Party concerned with the express.",
                            }),
                            new Paragraph({
                                text: "9.4. This Agreement may be terminated on the grounds and in the manner established by the legislation of Armenia.",
                            }),
                            new Paragraph({
                                text: "9.5. In all that is not provided in this Agreement Parties shall follow the applicable Armenia.",
                            }),
                            new Paragraph({
                                text: "9.6. The Parties shall resolve through negotiations all disputes arising during the execution of this Agreement.",
                            }),
                            new Paragraph({
                                text: "In case no agreement is reached by negotiation, the Party concerned sends a written claim to the other party by fax or by e-mail or by courier mail. The term of consideration of the claim is five business days from the date of its receipt.",
                            }),
                            new Paragraph({
                                text: "9.7. This Agreement is made in two copies having equal legal force, one copy for each Party.",
                            }),
                            new Paragraph({
                                text: "10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "Customer",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: data.customerName,
                            }),
                            new Paragraph({
                                text: data.customerAddress,
                            }),
                            new Paragraph({
                                text: data.customerCity,
                            }),
                            new Paragraph({
                                text: data.customerPhone,
                            }),
                            new Paragraph({
                                text: data.customerEmail,
                            }),
                            new Paragraph({
                                text: `__________________/${data.customerSignatory}`,
                            }),
                            new Paragraph({
                                text: "Stamp",
                            }),
                            new Paragraph({
                                text: "Executor",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: "Time Quest Lab LLC",
                            }),
                            new Paragraph({
                                text: "Certificate of State registration: 269.110.1255490",
                            }),
                            new Paragraph({
                                text: "Tax ID: 1702302685",
                            }),
                            new Paragraph({
                                text: "Address: Armenia, Yerevan, 9 May str., 51/ 27",
                            }),
                            new Paragraph({
                                text: "Phone number: +374 98171651",
                            }),
                            new Paragraph({
                                text: "email: vasilypetrenko91@gmail.com",
                            }),
                            new Paragraph({
                                text: "USD",
                            }),
                            new Paragraph({
                                text: "Beneficiary bank: ARDSHINBANK",
                            }),
                            new Paragraph({
                                text: "Bank address: Yerevan, Grigor Lusavorich 13",
                            }),
                            new Paragraph({
                                text: "tel.: (+37410) 569660",
                            }),
                            new Paragraph({
                                text: "SWIFT code: ASHBAM22",
                            }),
                            new Paragraph({
                                text: "Account #: 2474402605340010",
                            }),
                            new Paragraph({
                                text: "___________________/Petrenko V.A.",
                            }),
                            new Paragraph({
                                text: "Appendix No. 1. Specification for the Agreement ‚Ññ " + data.agreementNumber + " from " + formattedDate,
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: window.loadedSpecification ? "Specification data loaded from file" : "–ú–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞",
                            }),
                            new Paragraph({
                                text: "Customer",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: data.customerName,
                            }),
                            new Paragraph({
                                text: `__________________/${data.customerSignatory}`,
                            }),
                            new Paragraph({
                                text: "Executor",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: "Time Quest Lab LLC",
                            }),
                            new Paragraph({
                                text: "___________________/Petrenko V.A.",
                            })
                        ]
                    }]
                });

                // –°–æ–∑–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
                const price = parseInt(data.contractPrice) || 0;
                const fileName = `${data.agreementNumber}_${data.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_$${price}_${data.currency}.docx`;
                
                console.log('Creating DOCX document...');
                const blob = await Packer.toBlob(doc);
                console.log('DOCX blob created, size:', blob.size);
                
                // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —É blob –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π MIME —Ç–∏–ø
                if (blob.type !== 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
                    const docxBlob = new Blob([blob], { 
                        type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
                    });
                    console.log('Blob type corrected to:', docxBlob.type);
                    return docxBlob;
                }
                
                console.log('Blob created:', blob);
                console.log('Blob type:', blob.type);
                console.log('File name:', fileName);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å saveAs
                if (typeof saveAs === 'undefined') {
                    throw new Error('FileSaver.js library not loaded');
                }
                saveAs(blob, fileName);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è DOCX:', error);
                // Fallback –Ω–∞ HTML –µ—Å–ª–∏ DOCX –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏–π)
                const contractContent = document.getElementById('contractPreview').innerHTML
                    .replace(/<span class="highlight">/g, '')
                    .replace(/<\/span>/g, '');
            const fullHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                        <title>Agreement ${data.agreementNumber}</title>
                    <style>
                        body { 
                            font-family: 'Times New Roman', serif; 
                            font-size: 12px; 
                            line-height: 1.4; 
                            max-width: 800px; 
                            margin: 0 auto; 
                            padding: 20px;
                        }
                        .highlight { 
                            background-color: #ffeb3b; 
                            padding: 2px 4px; 
                            border-radius: 3px; 
                        }
                        h3 { 
                            margin-top: 20px; 
                            margin-bottom: 10px; 
                        }
                        p { 
                            margin-bottom: 10px; 
                            text-align: justify; 
                        }
                        @media print {
                            body { margin: 0; padding: 15px; }
                        }
                    </style>
                </head>
                <body>
                    ${contractContent}
                </body>
                </html>
            `;
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
                a.download = `${data.agreementNumber}_${data.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_${data.contractPrice}$${data.currency}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è HTML —Ñ–∞–π–ª–∞
        function downloadHTML() {
            try {
                console.log('Creating HTML file...');
                
                const form = document.getElementById('contractForm');
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const date = new Date(data.agreementDate);
                const formattedDate = date.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });

                // –ü–æ–ª—É—á–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–≥–æ–≤–æ—Ä–∞
                const contractContent = document.getElementById('contractPreview').innerHTML;

                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—ã–π HTML –¥–æ–∫—É–º–µ–Ω—Ç
                const fullHTML = `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agreement ${data.agreementNumber}</title>
    <style>
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 12px; 
            line-height: 1.4; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px;
        }
        .highlight { 
            background-color: #ffeb3b; 
            padding: 2px 4px; 
            border-radius: 3px; 
        }
        h3 { 
            margin-top: 20px; 
            margin-bottom: 10px; 
        }
        p { 
            margin-bottom: 10px; 
            text-align: justify; 
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border: 2px solid #000;
        }
        table th, table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        table th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        @media print {
            body { margin: 0; padding: 15px; }
        }
    </style>
</head>
<body>
    ${contractContent}
</body>
</html>`;

                // –°–æ–∑–¥–∞–µ–º blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º
                const blob = new Blob([fullHTML], { type: 'text/html; charset=utf-8' });
                const fileName = `${data.agreementNumber}_${data.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_${data.contractPrice}$${data.currency}.html`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å saveAs
                if (typeof saveAs === 'undefined') {
                    throw new Error('FileSaver.js library not loaded');
                }
                saveAs(blob, fileName);
                console.log('HTML file created successfully!');
                
            } catch (error) {
                console.error('HTML creation error:', error);
                alert('HTML creation failed: ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ DOCX –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
        async function loadDocxLibrary() {
            try {
                console.log('Loading DOCX library...');
                
                // –°–æ–∑–¥–∞–µ–º script —ç–ª–µ–º–µ–Ω—Ç
                const script = document.createElement('script');
                script.src = 'https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js';
                script.onload = () => {
                    console.log('DOCX library loaded successfully!');
                    alert('DOCX library loaded! Try again.');
                };
                script.onerror = () => {
                    console.error('Failed to load DOCX library from cdnjs');
                    // –ü—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
                    const altScript = document.createElement('script');
                    altScript.src = 'https://unpkg.com/docx@7.8.2/build/index.js';
                    altScript.onload = () => {
                        console.log('DOCX library loaded from unpkg!');
                        alert('DOCX library loaded from alternative source! Try again.');
                    };
                    altScript.onerror = () => {
                        console.error('Failed to load DOCX library from all sources');
                        alert('Failed to load DOCX library. Please check your internet connection.');
                    };
                    document.head.appendChild(altScript);
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                console.error('Error loading DOCX library:', error);
                alert('Error loading DOCX library: ' + error.message);
            }
        }

                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ HTML —Ç–∞–±–ª–∏—Ü—ã –≤ RTF
        function convertHtmlTableToRtf(htmlContent) {
            try {
                console.log('Converting HTML to RTF:', htmlContent);
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const table = doc.querySelector('table');
                
                if (!table) {
                    console.log('No table found, converting to plain text');
                    return htmlContent.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').replace(/\n/g, '\\par ');
                }
                
                const rows = table.querySelectorAll('tr');
                console.log('Found table with', rows.length, 'rows');
                
                // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏
                const firstRow = rows[0];
                const cellsInFirstRow = firstRow.querySelectorAll('td, th');
                const numColumns = cellsInFirstRow.length;
                
                console.log('Number of columns:', numColumns);
                
                // –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
                const totalWidth = 8000;
                let columnWidths;
                
                if (numColumns === 6) {
                    // –î–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏: ID, Description, 4 —á–∏—Å–ª–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏
                    columnWidths = [1000, 3800, 800, 800, 800, 800];
                } else {
                    // –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–ª—É—á–∞–µ–≤
                    const widthPerColumn = Math.floor(totalWidth / numColumns);
                    columnWidths = Array(numColumns).fill(widthPerColumn);
                }
                
                console.log('Column widths:', columnWidths);
                
                let rtfTable = '\\par ';
                
                // –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å–æ –≤—Å–µ–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏
                rows.forEach((row, rowIndex) => {
                    const cells = row.querySelectorAll('td, th');
                    console.log(`Row ${rowIndex}: ${cells.length} cells`);
                    
                    // –ù–∞—á–∞–ª–æ —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                    rtfTable += '{\\trowd\\trgaph108\\trleft0';
                    
                    // –ß–µ—Ä–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–æ–∫–∏
                    rtfTable += '\\trbrdrt\\brdrs\\brdrw10\\brdrcolor0'; // –í–µ—Ä—Ö–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
                    rtfTable += '\\trbrdrl\\brdrs\\brdrw10\\brdrcolor0'; // –õ–µ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
                    rtfTable += '\\trbrdrb\\brdrs\\brdrw10\\brdrcolor0'; // –ù–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞
                    rtfTable += '\\trbrdrr\\brdrs\\brdrw10\\brdrcolor0'; // –ü—Ä–∞–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞
                    rtfTable += '\\trbrdrh\\brdrs\\brdrw10\\brdrcolor0'; // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
                    rtfTable += '\\trbrdrv\\brdrs\\brdrw10\\brdrcolor0'; // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
                    
                    // –ü–æ–∑–∏—Ü–∏–∏ –∫–æ–ª–æ–Ω–æ–∫
                    let currentX = 0;
                    for (let i = 0; i < columnWidths.length; i++) {
                        currentX += columnWidths[i];
                        rtfTable += `\\cellx${currentX}`;
                    }
                    
                    rtfTable += '\\pard\\intbl ';
                    
                    // –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —è—á–µ–µ–∫
                    cells.forEach((cell, cellIndex) => {
                        const cellText = cell.textContent.trim();
                        const escapedText = cellText
                            .replace(/[{}]/g, '\\$&')
                            .replace(/\\/g, '\\\\');
                        
                        const isHeader = cell.tagName.toLowerCase() === 'th';
                        
                        console.log(`Cell ${cellIndex}: "${cellText}", isHeader: ${isHeader}`);
                        
                        if (isHeader) {
                            // –ó–∞–≥–æ–ª–æ–≤–æ–∫: —Å–µ—Ä—ã–π —Ñ–æ–Ω + –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç
                            rtfTable += `\\cbpat1\\b ${escapedText}\\b0\\cbpat0 `;
                        } else {
                            // –û–±—ã—á–Ω–∞—è —è—á–µ–π–∫–∞
                            rtfTable += escapedText;
                        }
                        rtfTable += '\\cell ';
                    });
                    
                    // –ö–æ–Ω–µ—Ü —Å—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
                    rtfTable += '\\row }\\par ';
                });
                
                console.log('RTF table created successfully');
                return rtfTable;
            } catch (error) {
                console.error('Error converting table to RTF:', error);
                return htmlContent.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').replace(/\n/g, '\\par ');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è RTF —Ñ–∞–π–ª–∞ (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ DOCX)
        function downloadRTF() {
            try {
                console.log('Creating RTF file...');
                
                const form = document.getElementById('contractForm');
                const formData = new FormData(form);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
                const date = new Date(data.agreementDate);
                const formattedDate = date.toLocaleDateString('en-GB', {
                    day: '2-digit',
                    month: 'long',
                    year: 'numeric'
                });

                // –ó–∞–º–µ–Ω—è–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –¥–ª—è RTF –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ç–∞–±–ª–∏—Ü—ã
                let specData = '–ú–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞';
                
                console.log('window.loadedSpecification:', window.loadedSpecification);
                
                if (window.loadedSpecification) {
                    console.log('Specification found, length:', window.loadedSpecification.length);
                    console.log('Converting to RTF table...');
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º HTML —Ç–∞–±–ª–∏—Ü—É –≤ RTF —Ç–∞–±–ª–∏—Ü—É
                    specData = convertHtmlTableToRtf(window.loadedSpecification);
                    console.log('RTF table created, length:', specData.length);
                } else {
                    console.log('No specification loaded');
                }
                
                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—ã–π RTF —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ)
                const rtfContent = `{\\rtf1\\ansi\\deff0\\fs24
{\\colortbl;\\red0\\green0\\blue0;\\red245\\green245\\blue245;}
{\\qc\\b\\fs28 AGREEMENT \\u8470? ${data.agreementNumber}\\b0\\fs24\\par\\par}
{\\qr ${formattedDate}\\par\\par}
${data.customerName}, hereinafter referred to as the "Customer" on the one hand and Time Quest Lab LLC, hereinafter referred to as the "Executor" on the other hand, together referred to as the "Parties", have finalized the present Agreement, as follows:
\\par
{\\b 1. SUBJECT OF AGREEMENT\\b0\\par}
1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:
\\par
${data.workDescription.split('\n').map(line => `- ${line.trim()}`).join('\\par ')}
\\par
and the Customer shall accept the result of work performed and pay for them in the order provided herein.
\\par
1.2. The occurrence, exercise and protection of copyright on the result of executed works does not require registration or compliance with any other formalities. Intellectual property rights on the work belong to the Executor in full.
\\par
1.3. The price of the Agreement does not include expenses associated with the packaging and transportation of equipment, and they are paid by the Customer separately.
\\par
{\\b 2. TERMS\\b0\\par}
2.1. Executor undertakes to perform the work in accordance with p. 1.1. of this Agreement in the following terms:
\\par
2.1.1. The deadline for the work is ${data.deadlineDays} calendar days from the date the Executor receives the advance payment.
\\par
2.2. Executor if necessary or if there is a valid reason can be given an additional grace period agreed upon with the Customer, but not less than seven business days. These reasons include: violation of the terms of delivery by postal and courier services of components required for the manufacture of tools and devices for the technical implementation of the scenario solution, supply of defect components, preventing the production of equipment and devices for the technical implementation of the scenario solution, the deadline for completion of the works.
\\par
2.3. Executor in writing, as provided for n. 9.3. of this Agreement, informs the Customer about the need to provide him the grace period for the completion of works.
\\par
{\\b 3. PRICE OF WORK AND PAYMENT\\b0\\par}
3.1. The total Agreement price is $${formatNumber(parseInt(data.contractPrice) || 0)} (${numberToWords(parseInt(data.contractPrice) || 0)}) ${data.currency === 'EUR' ? 'euros' : 'US dollars'}.
\\par
3.2. Payment is made by the Customer ${data.paymentTerms} from the date of notification of the Contractor about the readiness of the package.
\\par
3.3. Payment under this Agreement shall be made by the Customer by non-cash payment to the Executor's current account.
\\par
3.4. The obligation of the Customer to pay the price of the Agreement shall be considered fulfilled when the funds are credited to the account of the Executor, unless the Parties agree otherwise.
\\par
{\\b 4. RIGHTS AND OBLIGATIONS OF THE PARTIES\\b0\\par}
4.1. Executor undertakes to:
\\par
4.1.1. Carry out work in accordance with the terms of this Agreement and submit the result of work to the Customer.
\\par
4.1.2. Carry out work at the agreed time.
\\par
4.1.3. In carrying out work under the Agreement not to violate the intellectual property rights of third parties.
\\par
4.1.4. Within six months from the moment of receiving the equipment, the customer is provided with technical and consulting online support during the installation and setting up of the equipment.
\\par
Free of charge: phone consultations on the "hot line" on business days from 3:00 to 12:00 (UTC), "hot line" phone number - +7-913-747-34-91 (WhatsApp).
\\par
Paid: phone consultations on the "hot line" on any day and at any time. The price for 1 hour is $ 40. The hotline phone number is + 7-913-747-34-91 (WhatsApp).
\\par
4.2. Executor has right to:
\\par
4.2.1. Not proceeding with the work, if the Customer does not list the advance payment and the terms set forth herein. In this case, the deadline for the work by the Executor begins to run from the day following the date of receipt of its settlement account the entire amount of the advance payment.
\\par
4.3. Customer undertakes to:
\\par
4.3.1. Accept and pay for the result of the Executor's work in the manner and terms set forth herein.
\\par
4.3.2. Use the result of the work only in his commercial activities.
\\par
4.3.3. Transfer to the Executor at the time of the conclusion of this Agreement the necessary technical documentation available in his possession: the plan of the room with dimensions (ceiling height, exact dimensions of all rooms, wall thickness).
\\par
4.3.4. After completion of the construction of the escape room, upon request, provide the Executor with photo and video materials on the work done for posting on the website and in social networks for marketing purposes.
\\par
4.3.5. The Customer must provide photos and video materials of the finished escape rooms within a specific period (two weeks) after launch. Otherwise, the Executor has the right not to provide technical support in accordance with clause 4.1.4.
\\par
4.4. Customer has right to:
\\par
4.4.1. In unilaterally withdraw from the execution of this Agreement, after one month's written notice to the Executor and to pay him the actual costs incurred.
\\par
{\\b 5. ORDER ACCEPTANCE RESULT OF WORK\\b0\\par}
5.1. Acceptance of the result of the work performed is made by the Parties on the basis of Certificate of Delivery and Acceptance. The result of the work shall be deemed accepted by the Customer at the time of signing the Certificate of Delivery and Acceptance.
\\par
5.2. The Customer is obliged to accept and test the result of work and sign the Certificate of Delivery and Acceptance, within three business days of notification by the Executor of the work readiness.
\\par
5.3. The result of the work and installation work is considered accepted after three business days after notification by the Executor of the readiness of works if the Customer refuses to accept the result of the work and the signing of the Certificate of Delivery and Acceptance, without providing a written reasoned refusal within one working day.
\\par
5.4. The Customer must notify Executor of the obvious shortcomings in the works at the time of signing the Certificate of Delivery and Acceptance. Executor undertakes on his own and at his own expense to eliminate obvious defects in the works. If the Customer fails to notify Executor about presence of obvious deficiencies within the period specified in the agreement, he loses the right to rely on them in the future.
\\par
{\\b 6. CONFIDENTIALITY\\b0\\par}
6.1. The Parties undertake not to disclose confidential information that has become known to them during the execution of this Agreement.
\\par
6.2. By "confidential information" within the meaning of the Agreement the following information is assigned:
\\par
- information on technical, programmatic and technological developments and solutions;
\\par
- information about the financial status of the Parties, the size of the profits, as well as other financial account information;
\\par
- information related to the management: used developments and management solutions, ways of doing things, tactics and strategy of management, etc.;
\\par
- information about past, present and potential clients and partners;
\\par
- information on employees;
\\par
- other information, disclosure, transfer or leakage of which could damage the interests of each of the Parties;
\\par
- information about the content and material conditions of the execution of this Agreement by the Parties.
\\par
6.3. Under the "disclosure of confidential information" within the meaning of this Agreement must be understood:
\\par
- transfer to third parties of the relevant documents containing confidential information, including with the use of e-mail, facsimile, electronic mail (e-mail), via the Internet, as well as by any other means, to identify the contents of the relevant documents;
\\par
- transfer to third parties of the information related to confidential information, in oral or written form, including with the use of a telephone, mail, facsimile, electronic mail (e-mail), via the Internet, as well as in any other way, allowing the identification of the content of the relevant information;
\\par
- made in any other way bringing to the attention of third parties of the confidential information of each of the Parties.
\\par
6.4. In case of unfair use or disclosure of confidential information, the injured party is entitled to demand compensation for damages caused to it because of such an unfair use or disclosure of confidential information.
\\par
6.5. The parties mutually undertake to store provided by the other party relating to the subject matter of this Agreement documents and business papers in a place adapted for this, as well as let only authorized people work with them.
\\par
{\\b 7. RESPONSIBILITY OF THE PARTIES\\b0\\par}
7.1. The Customer has the right to submit Executor a request for payment of the penalty of 0.1% of the price of work for each day of delay, but not more than 10% of the cost of works in case of violation by the Executor the agreed period of performance.
\\par
7.2. For non-fulfillment or improper fulfillment of other duties under this Agreement the Parties bear responsibility established by the legislation of Armenia.
\\par
{\\b 8. FORCE MAJEURE\\b0\\par}
8.1. Parties are not responsible for complete or partial failure to fulfill obligations under this Agreement if such failure will be the result of force majeure, which include riots, prohibitive actions of the authorities, natural disasters, fires, accidents or other force majeure.
\\par
8.2. The Parties shall notify in writing each other about the existence of force majeure, within 5 (five) days from the date of their occurrence.
\\par
8.3. If the existence of such force majeure circumstances directly affected the performance of the Parties' obligations within the period specified in this Agreement, the time limits are extended for the duration of the relevant circumstances.
\\par
8.4. If the impossibility of performance of the Parties' obligations under this Agreement will last more than one (1) month, the Parties may terminate this Agreement, followed by settlements, without the obligation to compensate for potential losses.
\\par
{\\b 9. OTHER CONDITIONS\\b0\\par}
9.1. This Agreement shall enter into force on the date of its signing and is valid until the Parties fulfill their obligations hereunder.
\\par
9.2. All changes and additions to this Agreement must be made in writing and signed by the Parties.
\\par
9.3. The parties recognize legal force and consider the Agreement, specifications to it, additional agreements, acts, notifications about the readiness of the Executor's work result as well as notice of the need to provide a grace period for completion of work, claims submitted by fax or e-mail, written documents, if there is the ability to reliably establish that the document comes precisely from the Party according to the Agreement.
\\par
All other notifications and notices related to the execution of this Agreement shall be sent by the Parties in a letter with acknowledgment of receipt or shall be delivered to the Party concerned with the express.
\\par
9.4. This Agreement may be terminated on the grounds and in the manner established by the legislation of Armenia.
\\par
9.5. In all that is not provided in this Agreement Parties shall follow the applicable Armenia.
\\par
9.6. The Parties shall resolve through negotiations all disputes arising during the execution of this Agreement.
\\par
In case no agreement is reached by negotiation, the Party concerned sends a written claim to the other party by fax or by e-mail or by courier mail. The term of consideration of the claim is five business days from the date of its receipt.
\\par
9.7. This Agreement is made in two copies having equal legal force, one copy for each Party.
\\par
{\\b 10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES\\b0\\par}
{\\b Customer\\b0\\par}
${data.customerName}\\par
${data.customerAddress}\\par
${data.customerCity}\\par
${data.customerPhone}\\par
${data.customerEmail}\\par
__________________/${data.customerSignatory}\\par
Stamp\\par\\par
{\\b Executor\\b0\\par}
Time Quest Lab LLC\\par
Certificate of State registration: 269.110.1255490\\par
Tax ID: 1702302685\\par
Address: Armenia, Yerevan, 9 May str., 51/ 27\\par
Phone number: +374 98171651\\par
email: vasilypetrenko91@gmail.com\\par
USD\\par
Beneficiary bank: ARDSHINBANK\\par
Bank address: Yerevan, Grigor Lusavorich 13\\par
tel.: (+37410) 569660\\par
SWIFT code: ASHBAM22\\par
Account #: 2474402605340010\\par
___________________/Petrenko V.A.\\par\\par
{\\page\\b Appendix No. 1. Specification for the Agreement \\u8470? ${data.agreementNumber} from ${formattedDate}\\b0\\par}
${specData}\\par\\par
{\\b Customer\\b0\\par}
${data.customerName}\\par
__________________/${data.customerSignatory}\\par\\par
{\\b Executor\\b0\\par}
Time Quest Lab LLC\\par
___________________/Petrenko V.A.\\par
}`;

                // –°–æ–∑–¥–∞–µ–º blob –∏ —Å–∫–∞—á–∏–≤–∞–µ–º
                const blob = new Blob([rtfContent], { type: 'application/rtf; charset=utf-8' });
                const fileName = `${data.agreementNumber}_${data.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_${data.contractPrice}$${data.currency}.rtf`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å saveAs
                if (typeof saveAs === 'undefined') {
                    throw new Error('FileSaver.js library not loaded');
                }
                saveAs(blob, fileName);
                console.log('RTF file created successfully!');
                console.log('Final specData:', specData);
                
            } catch (error) {
                console.error('RTF creation error:', error);
                alert('RTF creation failed: ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ DOCX —Å –ø–æ–ª–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
        async function downloadContractNew() {
            const form = document.getElementById('contractForm');
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const date = new Date(data.agreementDate);
            const formattedDate = date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å docx –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                if (typeof docx === 'undefined') {
                    console.error('DOCX library not loaded, attempting to load...');
                    await loadDocxLibrary();
                    // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    if (typeof docx === 'undefined') {
                        throw new Error('Failed to load docx library');
                    }
                }
                
                console.log('docx library loaded successfully');
                
                // –°–æ–∑–¥–∞–µ–º DOCX –¥–æ–∫—É–º–µ–Ω—Ç –±–µ–∑ –≤—ã–¥–µ–ª–µ–Ω–∏–π
                const { Document, Packer, Paragraph, HeadingLevel, AlignmentType, Table, TableRow, TableCell, WidthType, PageBreak, TextRun, BorderStyle } = docx;

                // –ü–æ–ª—É—á–∞–µ–º —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
                let specificationTable = null;
                if (window.loadedSpecification) {
                    try {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(window.loadedSpecification, 'text/html');
                        const table = doc.querySelector('table');
                        
                        if (table) {
                            const rows = table.querySelectorAll('tr');
                            const tableRows = [];
                            
                            rows.forEach((row, rowIndex) => {
                                const cells = row.querySelectorAll('td, th');
                                const tableCells = [];
                                
                                cells.forEach(cell => {
                                    const cellText = cell.textContent.trim();
                                    tableCells.push(new TableCell({
                                        children: [new Paragraph({ text: cellText })]
                                    }));
                                });
                                
                                tableRows.push(new TableRow({ children: tableCells }));
                            });
                            
                            specificationTable = new Table({ 
                                rows: tableRows,
                                width: { size: 100, type: WidthType.PERCENTAGE },
                                borders: {
                                    top: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                                    bottom: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                                    left: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                                    right: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                                    insideHorizontal: { style: BorderStyle.SINGLE, size: 1, color: "000000" },
                                    insideVertical: { style: BorderStyle.SINGLE, size: 1, color: "000000" }
                                }
                            });
                        }
                    } catch (error) {
                        console.error('Error parsing specification table:', error);
                    }
                }

                // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (–∫–∞–∫ –≤ —à–∞–±–ª–æ–Ω–µ)
                const doc = new Document({
                    styles: {
                        default: {
                            document: {
                                run: {
                                    font: "Times New Roman",
                                    size: 24, // 12pt –≤ half-points
                                    color: "000000"
                                },
                                paragraph: {
                                    spacing: {
                                        before: 120, // 6pt –≤ half-points
                                        after: 120    // 6pt –≤ half-points
                                    }
                                }
                            }
                        }
                    },
                    sections: [{
                        properties: {},
                        children: [
                            new Paragraph({
                                text: `AGREEMENT ‚Ññ ${data.agreementNumber}`,
                                heading: HeadingLevel.TITLE,
                                alignment: AlignmentType.CENTER,
                            }),
                            new Paragraph({
                                text: formattedDate,
                                alignment: AlignmentType.RIGHT,
                            }),
                            new Paragraph({
                                text: `${data.customerName}, hereinafter referred to as the "Customer" on the one hand and Time Quest Lab LLC, hereinafter referred to as the "Executor" on the other hand, together referred to as the "Parties", have finalized the present Agreement, as follows:`,
                            }),
                            new Paragraph({
                                text: "1. SUBJECT OF AGREEMENT",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "1.1. Under this Agreement the Executor undertakes to perform the following works by the Customer's task:",
                            }),
                            new Paragraph({
                                text: data.workDescription.split('\n').map(line => `- ${line.trim()}`).join('\n'),
                            }),
                            new Paragraph({
                                text: "and the Customer shall accept the result of work performed and pay for them in the order provided herein.",
                            }),
                            new Paragraph({
                                text: "1.2. The occurrence, exercise and protection of copyright on the result of executed works does not require registration or compliance with any other formalities. Intellectual property rights on the work belong to the Executor in full.",
                            }),
                            new Paragraph({
                                text: "1.3. The price of the Agreement does not include expenses associated with the packaging and transportation of equipment, and they are paid by the Customer separately.",
                            }),
                            new Paragraph({
                                text: "2. TERMS",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "2.1. Executor undertakes to perform the work in accordance with p. 1.1. of this Agreement in the following terms:",
                            }),
                            new Paragraph({
                                text: `2.1.1. The deadline for the work is ${data.deadlineDays} calendar days from the date the Executor receives the advance payment.`,
                            }),
                            new Paragraph({
                                text: "2.2. Executor if necessary or if there is a valid reason can be given an additional grace period agreed upon with the Customer, but not less than seven business days. These reasons include: violation of the terms of delivery by postal and courier services of components required for the manufacture of tools and devices for the technical implementation of the scenario solution, supply of defect components, preventing the production of equipment and devices for the technical implementation of the scenario solution, the deadline for completion of the works.",
                            }),
                            new Paragraph({
                                text: "2.3. Executor in writing, as provided for n. 9.3. of this Agreement, informs the Customer about the need to provide him the grace period for the completion of works.",
                            }),
                            new Paragraph({
                                text: "3. PRICE OF WORK AND PAYMENT",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: `3.1. The total Agreement price is $${formatNumber(parseInt(data.contractPrice) || 0)} (${numberToWords(parseInt(data.contractPrice) || 0)}) ${data.currency === 'EUR' ? 'euros' : 'US dollars'}.`,
                            }),
                            new Paragraph({
                                text: `3.2. Payment is made by the Customer ${data.paymentTerms} from the date of notification of the Contractor about the readiness of the package.`,
                            }),
                            new Paragraph({
                                text: "3.3. Payment under this Agreement shall be made by the Customer by non-cash payment to the Executor's current account.",
                            }),
                            new Paragraph({
                                text: "3.4. The obligation of the Customer to pay the price of the Agreement shall be considered fulfilled when the funds are credited to the account of the Executor, unless the Parties agree otherwise.",
                            }),
                            new Paragraph({
                                text: "4. RIGHTS AND OBLIGATIONS OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "4.1. Executor undertakes to:",
                            }),
                            new Paragraph({
                                text: "4.1.1. Carry out work in accordance with the terms of this Agreement and submit the result of work to the Customer.",
                            }),
                            new Paragraph({
                                text: "4.1.2. Carry out work at the agreed time.",
                            }),
                            new Paragraph({
                                text: "4.1.3. In carrying out work under the Agreement not to violate the intellectual property rights of third parties.",
                            }),
                            new Paragraph({
                                text: "4.1.4. Within six months from the moment of receiving the equipment, the customer is provided with technical and consulting online support during the installation and setting up of the equipment.",
                            }),
                            new Paragraph({
                                text: "Free of charge: phone consultations on the \"hot line\" on business days from 3:00 to 12:00 (UTC), \"hot line\" phone number - +7-913-747-34-91 (WhatsApp).",
                            }),
                            new Paragraph({
                                text: "Paid: phone consultations on the \"hot line\" on any day and at any time. The price for 1 hour is $ 40. The hotline phone number is + 7-913-747-34-91 (WhatsApp).",
                            }),
                            new Paragraph({
                                text: "4.2. Executor has right to:",
                            }),
                            new Paragraph({
                                text: "4.2.1. Not proceeding with the work, if the Customer does not list the advance payment and the terms set forth herein. In this case, the deadline for the work by the Executor begins to run from the day following the date of receipt of its settlement account the entire amount of the advance payment.",
                            }),
                            new Paragraph({
                                text: "4.3. Customer undertakes to:",
                            }),
                            new Paragraph({
                                text: "4.3.1. Accept and pay for the result of the Executor's work in the manner and terms set forth herein.",
                            }),
                            new Paragraph({
                                text: "4.3.2. Use the result of the work only in his commercial activities.",
                            }),
                            new Paragraph({
                                text: "4.3.3. Transfer to the Executor at the time of the conclusion of this Agreement the necessary technical documentation available in his possession: the plan of the room with dimensions (ceiling height, exact dimensions of all rooms, wall thickness).",
                            }),
                            new Paragraph({
                                text: "4.3.4. After completion of the construction of the escape room, upon request, provide the Executor with photo and video materials on the work done for posting on the website and in social networks for marketing purposes.",
                            }),
                            new Paragraph({
                                text: "4.3.5. The Customer must provide photos and video materials of the finished escape rooms within a specific period (two weeks) after launch. Otherwise, the Executor has the right not to provide technical support in accordance with clause 4.1.4.",
                            }),
                            new Paragraph({
                                text: "4.4. Customer has right to:",
                            }),
                            new Paragraph({
                                text: "4.4.1. In unilaterally withdraw from the execution of this Agreement, after one month's written notice to the Executor and to pay him the actual costs incurred.",
                            }),
                            new Paragraph({
                                text: "5. ORDER ACCEPTANCE RESULT OF WORK",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "5.1. Acceptance of the result of the work performed is made by the Parties on the basis of Certificate of Delivery and Acceptance. The result of the work shall be deemed accepted by the Customer at the time of signing the Certificate of Delivery and Acceptance.",
                            }),
                            new Paragraph({
                                text: "5.2. The Customer is obliged to accept and test the result of work and sign the Certificate of Delivery and Acceptance, within three business days of notification by the Executor of the work readiness.",
                            }),
                            new Paragraph({
                                text: "5.3. The result of the work and installation work is considered accepted after three business days after notification by the Executor of the readiness of works if the Customer refuses to accept the result of the work and the signing of the Certificate of Delivery and Acceptance, without providing a written reasoned refusal within one working day.",
                            }),
                            new Paragraph({
                                text: "5.4. The Customer must notify Executor of the obvious shortcomings in the works at the time of signing the Certificate of Delivery and Acceptance. Executor undertakes on his own and at his own expense to eliminate obvious defects in the works. If the Customer fails to notify Executor about presence of obvious deficiencies within the period specified in the agreement, he loses the right to rely on them in the future.",
                            }),
                            new Paragraph({
                                text: "6. CONFIDENTIALITY",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "6.1. The Parties undertake not to disclose confidential information that has become known to them during the execution of this Agreement.",
                            }),
                            new Paragraph({
                                text: "6.2. By \"confidential information\" within the meaning of the Agreement the following information is assigned:",
                            }),
                            new Paragraph({
                                text: "- information on technical, programmatic and technological developments and solutions;",
                            }),
                            new Paragraph({
                                text: "- information about the financial status of the Parties, the size of the profits, as well as other financial account information;",
                            }),
                            new Paragraph({
                                text: "- information related to the management: used developments and management solutions, ways of doing things, tactics and strategy of management, etc.;",
                            }),
                            new Paragraph({
                                text: "- information about past, present and potential clients and partners;",
                            }),
                            new Paragraph({
                                text: "- information on employees;",
                            }),
                            new Paragraph({
                                text: "- other information, disclosure, transfer or leakage of which could damage the interests of each of the Parties;",
                            }),
                            new Paragraph({
                                text: "- information about the content and material conditions of the execution of this Agreement by the Parties.",
                            }),
                            new Paragraph({
                                text: "6.3. Under the \"disclosure of confidential information\" within the meaning of this Agreement must be understood:",
                            }),
                            new Paragraph({
                                text: "- transfer to third parties of the relevant documents containing confidential information, including with the use of e-mail, facsimile, electronic mail (e-mail), via the Internet, as well as by any other means, to identify the contents of the relevant documents;",
                            }),
                            new Paragraph({
                                text: "- transfer to third parties of the information related to confidential information, in oral or written form, including with the use of a telephone, mail, facsimile, electronic mail (e-mail), via the Internet, as well as in any other way, allowing the identification of the content of the relevant information;",
                            }),
                            new Paragraph({
                                text: "- made in any other way bringing to the attention of third parties of the confidential information of each of the Parties.",
                            }),
                            new Paragraph({
                                text: "6.4. In case of unfair use or disclosure of confidential information, the injured party is entitled to demand compensation for damages caused to it because of such an unfair use or disclosure of confidential information.",
                            }),
                            new Paragraph({
                                text: "6.5. The parties mutually undertake to store provided by the other party relating to the subject matter of this Agreement documents and business papers in a place adapted for this, as well as let only authorized people work with them.",
                            }),
                            new Paragraph({
                                text: "7. RESPONSIBILITY OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "7.1. The Customer has the right to submit Executor a request for payment of the penalty of 0.1% of the price of work for each day of delay, but not more than 10% of the cost of works in case of violation by the Executor the agreed period of performance.",
                            }),
                            new Paragraph({
                                text: "7.2. For non-fulfillment or improper fulfillment of other duties under this Agreement the Parties bear responsibility established by the legislation of Armenia.",
                            }),
                            new Paragraph({
                                text: "8. FORCE MAJEURE",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "8.1. Parties are not responsible for complete or partial failure to fulfill obligations under this Agreement if such failure will be the result of force majeure, which include riots, prohibitive actions of the authorities, natural disasters, fires, accidents or other force majeure.",
                            }),
                            new Paragraph({
                                text: "8.2. The Parties shall notify in writing each other about the existence of force majeure, within 5 (five) days from the date of their occurrence.",
                            }),
                            new Paragraph({
                                text: "8.3. If the existence of such force majeure circumstances directly affected the performance of the Parties' obligations within the period specified in this Agreement, the time limits are extended for the duration of the relevant circumstances.",
                            }),
                            new Paragraph({
                                text: "8.4. If the impossibility of performance of the Parties' obligations under this Agreement will last more than one (1) month, the Parties may terminate this Agreement, followed by settlements, without the obligation to compensate for potential losses.",
                            }),
                            new Paragraph({
                                text: "9. OTHER CONDITIONS",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "9.1. This Agreement shall enter into force on the date of its signing and is valid until the Parties fulfill their obligations hereunder.",
                            }),
                            new Paragraph({
                                text: "9.2. All changes and additions to this Agreement must be made in writing and signed by the Parties.",
                            }),
                            new Paragraph({
                                text: "9.3. The parties recognize legal force and consider the Agreement, specifications to it, additional agreements, acts, notifications about the readiness of the Executor's work result as well as notice of the need to provide a grace period for completion of work, claims submitted by fax or e-mail, written documents, if there is the ability to reliably establish that the document comes precisely from the Party according to the Agreement.",
                            }),
                            new Paragraph({
                                text: "All other notifications and notices related to the execution of this Agreement shall be sent by the Parties in a letter with acknowledgment of receipt or shall be delivered to the Party concerned with the express.",
                            }),
                            new Paragraph({
                                text: "9.4. This Agreement may be terminated on the grounds and in the manner established by the legislation of Armenia.",
                            }),
                            new Paragraph({
                                text: "9.5. In all that is not provided in this Agreement Parties shall follow the applicable Armenia.",
                            }),
                            new Paragraph({
                                text: "9.6. The Parties shall resolve through negotiations all disputes arising during the execution of this Agreement.",
                            }),
                            new Paragraph({
                                text: "In case no agreement is reached by negotiation, the Party concerned sends a written claim to the other party by fax or by e-mail or by courier mail. The term of consideration of the claim is five business days from the date of its receipt.",
                            }),
                            new Paragraph({
                                text: "9.7. This Agreement is made in two copies having equal legal force, one copy for each Party.",
                            }),
                            new Paragraph({
                                text: "10. ADDRESSES, DETAILS AND SIGNATURES OF THE PARTIES",
                                heading: HeadingLevel.HEADING_1,
                            }),
                            new Paragraph({
                                text: "Customer",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: data.customerName,
                            }),
                            new Paragraph({
                                text: data.customerAddress,
                            }),
                            new Paragraph({
                                text: data.customerCity,
                            }),
                            new Paragraph({
                                text: data.customerPhone,
                            }),
                            new Paragraph({
                                text: data.customerEmail,
                            }),
                            new Paragraph({
                                text: `__________________/${data.customerSignatory}`,
                            }),
                            new Paragraph({
                                text: "Stamp",
                            }),
                            new Paragraph({
                                text: "Executor",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: "Time Quest Lab LLC",
                            }),
                            new Paragraph({
                                text: "Certificate of State registration: 269.110.1255490",
                            }),
                            new Paragraph({
                                text: "Tax ID: 1702302685",
                            }),
                            new Paragraph({
                                text: "Address: Armenia, Yerevan, 9 May str., 51/ 27",
                            }),
                            new Paragraph({
                                text: "Phone number: +374 98171651",
                            }),
                            new Paragraph({
                                text: "email: vasilypetrenko91@gmail.com",
                            }),
                            new Paragraph({
                                text: "USD",
                            }),
                            new Paragraph({
                                text: "Beneficiary bank: ARDSHINBANK",
                            }),
                            new Paragraph({
                                text: "Bank address: Yerevan, Grigor Lusavorich 13",
                            }),
                            new Paragraph({
                                text: "tel.: (+37410) 569660",
                            }),
                            new Paragraph({
                                text: "SWIFT code: ASHBAM22",
                            }),
                            new Paragraph({
                                text: "Account #: 2474402605340010",
                            }),
                            new Paragraph({
                                text: "___________________/Petrenko V.A.",
                            }),
                            // –†–∞–∑—Ä—ã–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–¥ Appendix
                            new Paragraph({
                                children: [new PageBreak()]
                            }),
                            new Paragraph({
                                text: "Appendix No. 1. Specification for the Agreement ‚Ññ " + data.agreementNumber + " from " + formattedDate,
                                heading: HeadingLevel.HEADING_1,
                            }),
                            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
                            ...(specificationTable ? [specificationTable] : [new Paragraph({
                                text: window.loadedSpecification ? "Specification data loaded from file" : "–ú–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞",
                            })]),
                            new Paragraph({
                                text: "Customer",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: data.customerName,
                            }),
                            new Paragraph({
                                text: `__________________/${data.customerSignatory}`,
                            }),
                            new Paragraph({
                                text: "Executor",
                                heading: HeadingLevel.HEADING_2,
                            }),
                            new Paragraph({
                                text: "Time Quest Lab LLC",
                            }),
                            new Paragraph({
                                text: "___________________/Petrenko V.A.",
                            })
                        ]
                    }]
                });

                // –°–æ–∑–¥–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
                const price = parseInt(data.contractPrice) || 0;
                const fileName = `${data.agreementNumber}_${data.customerName.replace(/[^a-zA-Z0-9]/g, '_')}_$${price}_${data.currency}.docx`;
                
                console.log('Creating DOCX document...');
                const blob = await Packer.toBlob(doc);
                console.log('DOCX blob created, size:', blob.size);
                
                // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å saveAs
                if (typeof saveAs === 'undefined') {
                    throw new Error('FileSaver.js library not loaded');
                }
                saveAs(blob, fileName);
                console.log('DOCX file downloaded successfully!');
                
            } catch (error) {
                console.error('DOCX creation error:', error);
                alert('DOCX creation failed: ' + error.message + '\n\nFalling back to HTML download...');
                
                // Fallback –∫ HTML
                downloadHTML();
            }
        }

        // –ü—Ä–æ—Å—Ç–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ DOCX
        async function testDocxExport() {
            try {
                console.log('Testing DOCX export...');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å docx –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
                if (typeof docx === 'undefined') {
                    console.error('DOCX library not loaded, attempting to load...');
                    await loadDocxLibrary();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    if (typeof docx === 'undefined') {
                        throw new Error('Failed to load docx library');
                    }
                }
                
                const { Document, Packer, Paragraph, HeadingLevel } = docx;
                
                // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: [
                            new Paragraph({
                                text: "Test Document",
                                heading: HeadingLevel.TITLE,
                            }),
                            new Paragraph({
                                text: "This is a test document to verify DOCX functionality.",
                            }),
                            new Paragraph({
                                text: "If you can see this, DOCX export is working!",
                            })
                        ]
                    }]
                });
                
                console.log('Creating test DOCX document...');
                const blob = await Packer.toBlob(doc);
                console.log('Test DOCX blob created, size:', blob.size);
                
                if (typeof saveAs === 'undefined') {
                    throw new Error('FileSaver.js library not loaded');
                }
                
                saveAs(blob, 'test_document.docx');
                console.log('Test DOCX file downloaded successfully!');
                alert('Test DOCX file created successfully!');
                
            } catch (error) {
                console.error('Test DOCX creation error:', error);
                alert('Test DOCX creation failed: ' + error.message);
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–≥–æ–≤–æ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –ø–æ–ª—è
        document.getElementById('contractForm').addEventListener('input', generateContract);
    </script>
</body>
</html>